import{r as a,n as M,j as t,l as o,v as _,o as q,p as f,B as F,z as $,a7 as N,P as R,I as W,aa as z}from"./vendor-BEV2JtpX.js";import{D as J}from"./Delete-BxS1TgHm.js";import{S as O}from"./Search-DzlEfj5V.js";import{b as G,a as H,s as h}from"./index-CWCCNURT.js";import{C as K}from"./ConfirmModal-B0ScqVMC.js";import"./supabase-BTz4VuFi.js";const Q=a.createContext({});function V(){return a.useContext(Q)}function ae(){const p=M(),{user:n}=G(),{siteProfile:X,loading:P}=V(),{currentUsername:s,loading:S}=H(),[x,m]=a.useState([]),[w,g]=a.useState(!0),[v,b]=a.useState(""),[D,j]=a.useState(1),[I,Y]=a.useState(0),[E,c]=a.useState(!1),[l,d]=a.useState(null),T=async()=>{if(n!=null&&n.id)try{g(!0);const{data:e,error:r}=await h.from("posts").select(`
          *,
          images (
            url
          )
        `).eq("user_id",n.id).order("created_at",{ascending:!1});if(r)throw r;m(e||[])}catch{setError("Failed to fetch posts")}finally{g(!1)}};a.useEffect(()=>{n!=null&&n.id&&s&&s!=="undefined"&&T()},[n==null?void 0:n.id,s]);const k=e=>{b(e.target.value),j(1)},L=(e,r)=>{j(r)},U=e=>{d(e),c(!0)},A=async()=>{if(l)try{const{error:e}=await h.from("images").delete().eq("post_id",l.id);if(e)throw e;const{error:r}=await h.from("posts").delete().eq("id",l.id);if(r)throw r;m(x.filter(i=>i.id!==l.id)),c(!1),d(null)}catch(e){console.error("Error deleting post:",e)}},B=e=>{if(!s||s==="undefined"){console.warn("Username not available");return}p(`/${s}/post/${e.id}`)};return w||P||S||!s||s==="undefined"?t.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:t.jsx(_,{})}):t.jsxs(q,{maxWidth:"lg",sx:{mt:4,mb:4},children:[t.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[t.jsx(f,{variant:"h4",component:"h1",children:"Manage Posts"}),t.jsx(F,{variant:"contained",color:"primary",onClick:()=>{if(!s||s==="undefined"){console.warn("Username not available");return}p(`/${s}/create`)},children:"Create Post"})]}),t.jsx($,{fullWidth:!0,variant:"outlined",placeholder:"Search posts...",value:v,onChange:k,sx:{mb:4},InputProps:{startAdornment:t.jsx(N,{position:"start",children:t.jsx(O,{})})}}),x.map(e=>{var C,y;const r=(y=(C=e.images)==null?void 0:C[0])==null?void 0:y.url;let i=null;try{i=JSON.parse(r)[0]}catch{i=r}return t.jsxs(R,{sx:{p:2,mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(o,{sx:{display:"flex",gap:2,alignItems:"center",flex:1},children:[t.jsx(o,{sx:{width:100,flexShrink:0},children:i&&t.jsx(o,{component:"img",src:i,alt:e.title,sx:{width:"100%",height:100,objectFit:"cover",borderRadius:1},onError:u=>{u.target.src="/images/default.jpg"}})}),t.jsxs(o,{children:[t.jsx(f,{variant:"h6",component:"h2",sx:{cursor:"pointer"},onClick:()=>B(e),children:e.title}),t.jsxs(f,{variant:"body2",color:"text.secondary",children:["Last updated: ",new Date(e.updated_at).toLocaleDateString()]})]})]}),t.jsx(o,{children:t.jsx(W,{onClick:()=>U(e),color:"error",children:t.jsx(J,{})})})]},e.id)}),t.jsx(o,{sx:{display:"flex",justifyContent:"center",mt:4},children:t.jsx(z,{count:I,page:D,onChange:L,color:"primary"})}),t.jsx(K,{open:E,onClose:()=>{c(!1),d(null)},onConfirm:A,title:"Delete Post",content:"Are you sure you want to delete this post? This action cannot be undone."})]})}export{ae as default};
//# sourceMappingURL=Posts-DkCaTNk2.js.map
