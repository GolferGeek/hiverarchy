const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editor-CEOLRgZ6.js","assets/vendor-BEV2JtpX.js","assets/editor-Ch1M4OpB.css"])))=>i.map(i=>d[i]);
import{i as R,j as e,r as w,p as k,l as g,B as T,v as S,a8 as L,a9 as _,X as B,I}from"./vendor-BEV2JtpX.js";import{s as u}from"./index-CWCCNURT.js";import{D as F}from"./Delete-BxS1TgHm.js";import{_ as $}from"./supabase-BTz4VuFi.js";const O=R(e.jsx("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy"),P={"post-images":{maxSize:5242880,allowedTypes:["image/*"],maxDimensions:{width:2e3,height:2e3}},"interest-images":{maxSize:5242880,allowedTypes:["image/*"],maxDimensions:{width:2e3,height:2e3}},profile_logos:{maxSize:1048576,allowedTypes:["image/jpeg","image/png","image/gif"],maxDimensions:{width:500,height:500}}},N=(a,x,h)=>new Promise((s,y)=>{const n=new Image;n.src=URL.createObjectURL(a),n.onload=()=>{URL.revokeObjectURL(n.src);let l=n.width,d=n.height;if(l>x||d>h){const t=Math.min(x/l,h/d);l=Math.floor(l*t),d=Math.floor(d*t)}else{s(a);return}const m=document.createElement("canvas");m.width=l,m.height=d,m.getContext("2d").drawImage(n,0,0,l,d),m.toBlob(t=>{if(!t){y(new Error("Failed to resize image"));return}const f=new File([t],a.name,{type:a.type,lastModified:Date.now()});s(f)},a.type)},n.onerror=()=>{URL.revokeObjectURL(n.src),y(new Error("Failed to load image"))}});function X({onUpload:a,onRemove:x,existingImages:h=[],bucket:s="post-images",folder:y=null,showCopyOption:n=!0}){const[l,d]=w.useState(!1),[m,j]=w.useState(null),t=P[s],[f,U]=w.useState(!1),E=async()=>{try{const{data:r}=await u.storage.listBuckets();if(!r.some(i=>i.name===s))try{const{error:i}=await u.storage.createBucket(s,{public:!0,allowedMimeTypes:t.allowedTypes,fileSizeLimit:t.maxSize});if(i){console.error("Error creating bucket:",i);const{data:p}=await u.storage.listBuckets();return p.some(c=>c.name===s)}}catch(i){console.error("Error creating bucket:",i);const{data:p}=await u.storage.listBuckets();return p.some(c=>c.name===s)}return!0}catch(r){return console.error("Error checking/creating bucket:",r),!1}};w.useEffect(()=>{(async()=>{const o=await E();U(o)})()},[s]);const M=async r=>{if(!t)throw new Error("Invalid bucket configuration");if(!t.allowedTypes.some(o=>o==="image/*"?r.type.startsWith("image/"):o===r.type))throw new Error("Invalid file type");if(r.size>t.maxSize)throw new Error(`File size must be less than ${t.maxSize/1048576}MB`);return!0};async function C(r){try{if(!f&&!await E())throw new Error("Unable to initialize storage bucket");j(null),d(!0);const o=r.target.files[0];if(!o)return;await M(o);const i=await N(o,t.maxDimensions.width,t.maxDimensions.height),p=i.name.split(".").pop(),c=`${Math.random()}.${p}`,v=y?`${y}/${c}`:c,{error:z}=await u.storage.from(s).upload(v,i);if(z)throw z;const{data:b}=u.storage.from(s).getPublicUrl(v);b!=null&&b.publicUrl&&a([b.publicUrl])}catch(o){j(o.message),console.error("Error uploading image:",o)}finally{d(!1)}}const D=r=>{const o=`![image](${r})`;navigator.clipboard.writeText(o)};return t?e.jsxs(g,{children:[e.jsxs(g,{sx:{mb:2},children:[e.jsxs(T,{variant:"contained",component:"label",disabled:l||!f,children:[l?e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(S,{size:20,color:"inherit"}),e.jsx("span",{children:"Uploading..."})]}):f?"Upload Image":"Initializing...",e.jsx("input",{type:"file",accept:t.allowedTypes.join(","),onChange:C,hidden:!0})]}),e.jsxs(k,{variant:"caption",display:"block",sx:{mt:1,color:"text.secondary"},children:["Max dimensions: ",t.maxDimensions.width,"x",t.maxDimensions.height,"px"," | ","Max size: ",t.maxSize/1048576,"MB"]})]}),m&&e.jsx(k,{color:"error",sx:{mb:2},children:m}),(h==null?void 0:h.length)>0&&e.jsx(L,{sx:{width:"100%",maxHeight:300},cols:4,rowHeight:120,children:h.map((r,o)=>{const i=typeof r=="string"?r:r.url,p=(()=>{try{const c=JSON.parse(i);return Array.isArray(c)?c[0]:i}catch{return i}})();return e.jsx(_,{sx:{position:"relative"},children:e.jsxs(g,{sx:{position:"relative",height:"100%","&:hover .image-actions":{opacity:1}},children:[e.jsx("img",{src:p,alt:`Image ${o+1}`,loading:"lazy",style:{height:"120px",width:"120px",objectFit:"cover"}}),e.jsxs(g,{className:"image-actions",sx:{position:"absolute",top:0,right:0,padding:.5,display:"flex",gap:.5,opacity:0,transition:"opacity 0.2s",bgcolor:"rgba(0, 0, 0, 0.5)",borderRadius:"0 0 0 8px"},children:[n&&e.jsx(B,{title:"Copy Markdown",children:e.jsx(I,{size:"small",onClick:()=>D(p),sx:{color:"white","&:hover":{bgcolor:"rgba(255, 255, 255, 0.2)"}},children:e.jsx(O,{})})}),e.jsx(B,{title:"Delete",children:e.jsx(I,{size:"small",onClick:()=>x(r.id||r),sx:{color:"white","&:hover":{bgcolor:"rgba(255, 255, 255, 0.2)"}},children:e.jsx(F,{})})})]})]})},p)})})]}):e.jsx(k,{color:"error",children:"Invalid bucket configuration"})}const H=w.lazy(()=>$(()=>import("./editor-CEOLRgZ6.js").then(a=>a.i),__vite__mapDeps([0,1,2])));function q({value:a,onChange:x}){return e.jsx(w.Suspense,{fallback:e.jsx(g,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(S,{})}),children:e.jsx(g,{sx:{"& .w-md-editor":{margin:0,boxShadow:"none",border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:1,height:"1000px"},"& .wmde-markdown":{padding:"16px"},"& .w-md-editor-toolbar":{padding:"8px",borderBottom:"1px solid rgba(0, 0, 0, 0.1)"},"& .w-md-editor-content":{height:"calc(100% - 40px) !important"},"& .w-md-editor-input":{height:"100% !important"},"& .w-md-editor-text":{height:"100% !important"},"& .w-md-editor-text-input":{padding:"16px !important",height:"100% !important"},"& .w-md-editor-preview":{padding:"16px !important",height:"100% !important"}},children:e.jsx(H,{value:a,onChange:x,preview:"edit",highlightEnable:!1,enableScroll:!0})})})}export{X as I,q as M};
//# sourceMappingURL=MarkdownEditor-BzJKTVWG.js.map
