import{i as z,j as e,r as a,P,l as i,W as A,p as w,B as b,X as F,I as B,z as M,v as N,y as E,n as G,u as H}from"./vendor-BEV2JtpX.js";import{b as D,s as v}from"./index-BPoNtoii.js";import{f as O}from"./format-BzRktsyD.js";import{D as q}from"./Delete-BxS1TgHm.js";const $=z(e.jsx("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.996.996 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"}),"AutoFixHigh"),T=z(e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"}),"Reply"),U=z(e.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send");function V({comment:s,onDelete:p,onReply:d,depth:c=0}){const{user:f}=D(),[u,x]=a.useState(!1),[m,g]=a.useState(""),j=f&&f.id===s.user_id,l=()=>{m.trim()&&(d(s.id,m),g(""),x(!1))};return e.jsx(P,{elevation:0,sx:{p:2,mb:2,ml:c*4,bgcolor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:2},children:e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(A,{sx:{bgcolor:"primary.main"},children:s.username?s.username[0].toUpperCase():"?"}),e.jsxs(i,{sx:{flexGrow:1},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(i,{children:[e.jsx(w,{variant:"subtitle2",component:"span",children:s.username||"Anonymous"}),e.jsx(w,{variant:"caption",color:"text.secondary",sx:{ml:1},children:O(new Date(s.created_at),"MMM d, yyyy h:mm a")})]}),e.jsxs(i,{children:[e.jsx(b,{startIcon:e.jsx(T,{}),size:"small",onClick:()=>x(!u),sx:{mr:1},children:"Reply"}),j&&e.jsx(F,{title:"Delete comment",children:e.jsx(B,{onClick:()=>p(s.id),size:"small",color:"error",children:e.jsx(q,{fontSize:"small"})})})]})]}),e.jsx(w,{variant:"body2",color:"text.primary",sx:{whiteSpace:"pre-wrap"},children:s.content}),u&&e.jsxs(i,{sx:{mt:2},children:[e.jsx(M,{fullWidth:!0,multiline:!0,rows:3,value:m,onChange:h=>g(h.target.value),placeholder:"Write your reply...",sx:{mb:1}}),e.jsxs(i,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(b,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(b,{variant:"contained",onClick:l,disabled:!m.trim(),children:"Post Reply"})]})]})]})]})})}function Z({postId:s,onCountChange:p}){const{user:d}=D(),[c,f]=a.useState([]),[u,x]=a.useState(""),[m,g]=a.useState(!0),[j,l]=a.useState(null),[h,R]=a.useState(!1);a.useEffect(()=>{C()},[s]),a.useEffect(()=>{p&&p(c.length)},[c.length,p]);async function C(){try{l(null);const{data:n,error:t}=await v.from("comments").select(`
          *,
          profile:profiles (
            id,
            username,
            email
          )
        `).eq("post_id",s).order("created_at",{ascending:!0});if(t)throw t;const r=new Map,_=[];n.forEach(o=>{var y,k;o.user_email=(y=o.profile)==null?void 0:y.email,o.username=(k=o.profile)==null?void 0:k.username,o.replies=[],r.set(o.id,o)}),n.forEach(o=>{if(o.parent_id){const y=r.get(o.parent_id);y&&y.replies.push(o)}else _.push(o)}),f(_)}catch(n){console.error("Error fetching comments:",n),l("Failed to load comments. Please try again.")}finally{g(!1)}}async function I(n){if(n.preventDefault(),!(!d||!u.trim())){R(!0),l(null);try{const{error:t}=await v.from("comments").insert([{content:u.trim(),post_id:s,profile_id:d.id}]);if(t)throw t;x(""),await C()}catch(t){console.error("Error adding comment:",t),l("Failed to add comment. Please try again.")}finally{R(!1)}}}async function L(n){try{l(null);const{error:t}=await v.from("comments").delete().eq("id",n);if(t)throw t;f(c.filter(r=>r.id!==n))}catch(t){console.error("Error deleting comment:",t),l("Failed to delete comment. Please try again.")}}const W=async(n,t)=>{try{const{error:r}=await v.from("comments").insert([{content:t.trim(),post_id:s,profile_id:d.id,parent_id:n}]);if(r)throw r;await C()}catch(r){console.error("Error adding reply:",r),l("Failed to add reply. Please try again.")}},S=(n,t=0)=>n.map(r=>e.jsxs(i,{children:[e.jsx(V,{comment:r,onDelete:L,onReply:W,depth:t}),r.replies&&r.replies.length>0&&S(r.replies,t+1)]},r.id));return m?e.jsx(i,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(N,{})}):e.jsxs(i,{sx:{mt:4},children:[j&&e.jsx(E,{severity:"error",sx:{mb:2},children:j}),d?e.jsxs(P,{component:"form",onSubmit:I,elevation:1,sx:{p:3,mb:4,display:"flex",flexDirection:"column",gap:2,backgroundColor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:2},children:[e.jsx(M,{multiline:!0,rows:3,value:u,onChange:n=>x(n.target.value),placeholder:"Write a comment...",variant:"outlined",fullWidth:!0,disabled:h,sx:{"& .MuiOutlinedInput-root":{backgroundColor:"background.default","&:hover":{backgroundColor:"background.default","& .MuiOutlinedInput-notchedOutline":{borderColor:"primary.main"}},"&.Mui-focused":{backgroundColor:"background.default","& .MuiOutlinedInput-notchedOutline":{borderColor:"primary.main",borderWidth:2}}}}}),e.jsx(i,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(b,{type:"submit",variant:"contained",disabled:h||!u.trim(),endIcon:e.jsx(U,{}),sx:{px:3,py:1,borderRadius:2,textTransform:"none",fontWeight:500,"&:hover":{backgroundColor:"primary.dark"}},children:h?"Posting...":"Post Comment"})})]}):e.jsx(E,{severity:"info",sx:{mb:4},children:"Please log in to comment."}),e.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:c.length>0?S(c):e.jsx(w,{color:"text.secondary",align:"center",children:"No comments yet. Be the first to comment!"})})]})}function ee({postId:s,...p}){const d=G(),{username:c}=H(),f=()=>{d(`/${c}/writer/${s}`)};return e.jsx(b,{variant:"contained",color:"secondary",startIcon:e.jsx($,{}),onClick:f,...p,children:"AI Writer"})}function X({refutation:s,onDelete:p,onReply:d,depth:c=0}){const{user:f}=D(),[u,x]=a.useState(!1),[m,g]=a.useState(""),j=f&&f.id===s.user_id;s.user_email&&s.user_email[0].toUpperCase();const l=()=>{m.trim()&&(d(s.id,m),g(""),x(!1))};return e.jsx(P,{elevation:0,sx:{p:2,mb:2,ml:c*4,bgcolor:"error.lighter",border:"1px solid",borderColor:"error.light",borderRadius:2},children:e.jsxs(i,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(A,{sx:{bgcolor:"error.main"},children:s.username?s.username[0].toUpperCase():"?"}),e.jsxs(i,{sx:{flexGrow:1},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(i,{children:[e.jsx(w,{variant:"subtitle2",component:"span",children:s.username||"Anonymous"}),e.jsx(w,{variant:"caption",color:"text.secondary",sx:{ml:1},children:O(new Date(s.created_at),"MMM d, yyyy h:mm a")})]}),e.jsxs(i,{children:[e.jsx(b,{startIcon:e.jsx(T,{}),size:"small",onClick:()=>x(!u),sx:{mr:1},children:"Reply"}),j&&e.jsx(F,{title:"Delete refutation",children:e.jsx(B,{onClick:()=>p(s.id),size:"small",color:"error",children:e.jsx(q,{fontSize:"small"})})})]})]}),e.jsx(w,{variant:"body2",color:"text.primary",sx:{whiteSpace:"pre-wrap"},children:s.content}),u&&e.jsxs(i,{sx:{mt:2},children:[e.jsx(M,{fullWidth:!0,multiline:!0,rows:3,value:m,onChange:h=>g(h.target.value),placeholder:"Write your counter-refutation...",sx:{mb:1}}),e.jsxs(i,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[e.jsx(b,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(b,{variant:"contained",color:"error",onClick:l,disabled:!m.trim(),children:"Post Reply"})]})]})]})]})})}function re({postId:s,onCountChange:p}){const{user:d}=D(),[c,f]=a.useState([]),[u,x]=a.useState(""),[m,g]=a.useState(!0),[j,l]=a.useState(null),[h,R]=a.useState(!1);a.useEffect(()=>{C()},[s]),a.useEffect(()=>{p&&p(c.length)},[c.length,p]);const C=async()=>{try{const{data:n,error:t}=await v.from("refutations").select(`
          *,
          profile:profiles (
            id,
            username,
            email
          )
        `).eq("post_id",s).order("created_at",{ascending:!0});if(t)throw t;const r=new Map,_=[];n.forEach(o=>{var y,k;o.user_email=(y=o.profile)==null?void 0:y.email,o.username=(k=o.profile)==null?void 0:k.username,o.replies=[],r.set(o.id,o)}),n.forEach(o=>{if(o.parent_id){const y=r.get(o.parent_id);y&&y.replies.push(o)}else _.push(o)}),f(_||[]),g(!1)}catch(n){console.error("Error fetching refutations:",n),l(n.message),g(!1)}};async function I(n,t=null){if(n.preventDefault(),!(!d||!u.trim())){R(!0),l(null);try{const{error:r}=await v.from("refutations").insert([{content:u.trim(),post_id:s,profile_id:d.id,parent_id:t}]);if(r)throw r;x(""),await C()}catch(r){console.error("Error adding refutation:",r),l("Failed to add refutation. Please try again.")}finally{R(!1)}}}async function L(n){try{l(null);const{error:t}=await v.from("refutations").delete().eq("id",n);if(t)throw t;await C()}catch(t){console.error("Error deleting refutation:",t),l("Failed to delete refutation. Please try again.")}}const W=async(n,t)=>{try{const{error:r}=await v.from("refutations").insert([{content:t.trim(),post_id:s,profile_id:d.id,parent_id:n}]);if(r)throw r;await C()}catch(r){console.error("Error adding reply:",r),l("Failed to add reply. Please try again.")}},S=(n,t=0)=>n.map(r=>e.jsxs(i,{children:[e.jsx(X,{refutation:r,onDelete:L,onReply:W,depth:t}),r.replies&&r.replies.length>0&&S(r.replies,t+1)]},r.id));return m?e.jsx(i,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(N,{})}):e.jsxs(i,{sx:{mt:4},children:[j&&e.jsx(E,{severity:"error",sx:{mb:2},children:j}),d?e.jsxs(P,{component:"form",onSubmit:I,elevation:1,sx:{p:3,mb:4,display:"flex",flexDirection:"column",gap:2,backgroundColor:"background.paper",border:"1px solid",borderColor:"divider",borderRadius:2},children:[e.jsx(M,{multiline:!0,rows:3,value:u,onChange:n=>x(n.target.value),placeholder:"Write a refutation...",variant:"outlined",fullWidth:!0,disabled:h}),e.jsx(i,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(b,{type:"submit",variant:"contained",color:"error",disabled:h||!u.trim(),endIcon:e.jsx(U,{}),children:h?"Posting...":"Post Refutation"})})]}):e.jsx(E,{severity:"info",sx:{mb:4},children:"Please log in to post refutations."}),e.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:c.length>0?S(c):e.jsx(w,{color:"text.secondary",align:"center",children:"No refutations yet. Be the first to refute!"})})]})}export{Z as C,re as R,ee as W};
//# sourceMappingURL=RefutationList-BR1lsVGX.js.map
