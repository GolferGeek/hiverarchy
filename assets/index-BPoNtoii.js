const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-DC92nYi7.js","assets/vendor-BEV2JtpX.js","assets/supabase-BTz4VuFi.js","assets/Login-D6IxvcFv.js","assets/SignUp-DATWsej5.js","assets/ViewPost-BzYEoCnG.js","assets/editor-CEOLRgZ6.js","assets/editor-Ch1M4OpB.css","assets/RefutationList-BR1lsVGX.js","assets/format-BzRktsyD.js","assets/Delete-BxS1TgHm.js","assets/ConfirmModal-B0ScqVMC.js","assets/Edit-BOZ08VMc.js","assets/CreatePost-Bc6Q44Ml.js","assets/MarkdownEditor-CiQUfrIG.js","assets/EditPost-hVR_G_zq.js","assets/Save-CzW9L6yv.js","assets/ManageInterests-BkZfIIUP.js","assets/InterestPage-e4LjAHhQ.js","assets/Search-DzlEfj5V.js","assets/UserProfile-BVIRr_4q.js","assets/Posts-B3I6h7Nk.js","assets/Resume-B4fUYP08.js","assets/PostWriter-Q_u3KwUg.js"])))=>i.map(i=>d[i]);
import{d as ms,r as S,j as c,u as zn,e as ft,f as ps,h as gs,T as ys,C as _s,N as ot,i as mt,A as ws,k as bs,S as xs,B as we,L as he,l as Ce,I as _n,M as Ss,m as xt,n as Cs,o as As,G as le,p as te,P as Ke,q as vs,s as Ps,t as j,v as Es}from"./vendor-BEV2JtpX.js";import{c as Is,_ as K}from"./supabase-BTz4VuFi.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();var Kn,wn=ms;Kn=wn.createRoot,wn.hydrateRoot;const Rs="https://ssqyknqsfdtdxqocaiwm.supabase.co",ks="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzcXlrbnFzZmR0ZHhxb2NhaXdtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzUzMTc5NjMsImV4cCI6MjA1MDg5Mzk2M30.Ih6ruZj0rwAY1h8P80aMK2aS9m5LJzx3STWDG_A5TNg",W=Is(Rs,ks,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),Gn=S.createContext({});function Os({children:r}){const[e,t]=S.useState(null),[n,s]=S.useState(!0);S.useEffect(()=>{const{data:{subscription:u}}=W.auth.onAuthStateChange((g,h)=>{t((h==null?void 0:h.user)??null),s(!1)});return W.auth.getSession().then(({data:{session:g}})=>{t((g==null?void 0:g.user)??null),s(!1)}),()=>u.unsubscribe()},[]);async function a({email:u,password:g}){return await W.auth.signUp({email:u,password:g})}async function i({email:u,password:g}){return await W.auth.signInWithPassword({email:u,password:g})}async function o(){return await W.auth.signOut()}const l={user:e,loading:n,signUp:a,signIn:i,signOut:o};return c.jsx(Gn.Provider,{value:l,children:!n&&r})}const ke=()=>S.useContext(Gn),Qn=S.createContext();function pt(){return S.useContext(Qn)}function js({children:r}){const[e,t]=S.useState(null),[n,s]=S.useState(null),[a,i]=S.useState(!0),{username:o}=zn(),{user:l}=ke(),u="golfergeek",g=ft(),h=f=>!f||f==="null"||f==="undefined"?"/images/gg-logo.jpg":f.startsWith("http")||f.startsWith("data:")?f:`https://ssqyknqsfdtdxqocaiwm.supabase.co/storage/v1/object/public/profile_logos/${f}`,d=async f=>{try{(!f||f==="undefined"||f==="null")&&(console.log("Invalid username provided for profile fetch, using default:",u),f=u),console.log("fetchBlogProfile starting for username:",f);const{data:m,error:C}=await W.from("profiles").select("*").eq("username",f).single();if(C){if(console.error("Error in fetchBlogProfile:",C),f!==u)return console.log("Retrying with default username"),d(u);throw C}return console.log("fetchBlogProfile success:",m),m}catch(m){return console.error("Error fetching blog profile:",m),f!==u?(console.log("Error occurred, retrying with default username"),d(u)):null}},p=async f=>{try{const{data:m,error:C}=await W.from("profiles").select("*").eq("id",f).single();if(C)throw C;return m}catch{return null}},x=()=>{const f=g.pathname.split("/").filter(Boolean);if(!f.length||f[0]==="login"||f[0]==="signup")return u;const m=f[0];return m&&m!=="undefined"&&m!=="null"?m:u},_=async()=>{try{i(!0),console.log("Starting fetchProfiles");let f=o||x();(!f||f==="undefined"||f==="null")&&(console.log("Invalid username detected, using default:",u),f=u),console.log("Fetching profile for username:",f);const m=await d(f);console.log("Fetched blog profile:",m),t(m);const C=l?await p(l.id):null;console.log("Fetched user profile:",C),s(C)}catch(f){console.error("Error in fetchProfiles:",f),t(null),s(null)}finally{console.log("Completing fetchProfiles"),i(!1)}};S.useEffect(()=>{let f=!0;console.log("ProfileContext effect triggered:",{routeUsername:o,pathname:g.pathname,blogProfileExists:!!e,loading:a});const m=o||x();return(e==null?void 0:e.username)===m?(console.log("Profile already exists with correct username, skipping fetch"),a&&f&&i(!1),()=>{f=!1}):((async()=>{if(f)try{a||i(!0),console.log("Starting profile fetch for:",m);const w=await d(m);if(!f)return;w&&(console.log("Setting blog profile:",w.username),t(w),i(!1));const O=l?await p(l.id):null;if(!f)return;O&&(console.log("Setting user profile:",O.username),s(O))}catch(w){console.error("Error in profile fetch:",w),f&&(t(null),s(null),i(!1))}})(),()=>{f=!1})},[o,l==null?void 0:l.id,g.pathname]);const y={blogProfile:e,setBlogProfile:t,userProfile:n,loading:a||!e,fetchProfiles:_,isDefaultProfile:o===u,profile:e,currentUsername:o||x()||(e==null?void 0:e.username)||(n==null?void 0:n.username)||u,getFullLogoUrl:h};return console.log("ProfileContext render:",{loading:a,blogProfile:e==null?void 0:e.username}),c.jsx(Qn.Provider,{value:y,children:r})}const Yn=S.createContext();function Fs(){return S.useContext(Yn)}function $s({children:r}){const[e,t]=S.useState([]),[n,s]=S.useState(!0),{username:a}=zn(),{blogProfile:i}=pt(),o=ft(),l=()=>o.pathname.split("/").filter(Boolean)[0];S.useEffect(()=>{const g=a||l();if(i!=null&&i.id){s(!0),(async()=>{try{const{data:d,error:p}=await W.from("interests").select("*").eq("user_id",i.id).order("sequence",{ascending:!0}).order("title");t(p?[]:d||[])}catch{t([])}finally{s(!1)}})();return}if(g){s(!0),(async()=>{try{const{data:d,error:p}=await W.from("profiles").select("id").ilike("username",g).single();if(p||!d){t([]);return}const{data:x,error:_}=await W.from("interests").select("*").eq("user_id",d.id).order("sequence",{ascending:!0}).order("title");t(_?[]:x||[])}catch{t([])}finally{s(!1)}})();return}t([]),s(!1)},[a,i,o.pathname]);const u={interests:e,loading:n,fetchInterests:async()=>{const g=a||l();if(i!=null&&i.id){const{data:h,error:d}=await W.from("interests").select("*").eq("user_id",i.id).order("sequence",{ascending:!0}).order("title");return d?[]:h||[]}else if(g){const{data:h}=await W.from("profiles").select("id").ilike("username",g).single();if(h!=null&&h.id){const{data:d,error:p}=await W.from("interests").select("*").eq("user_id",h.id).order("sequence",{ascending:!0}).order("title");return p?[]:d||[]}}return[]}};return c.jsx(Yn.Provider,{value:u,children:r})}const Zn={typography:{fontFamily:'"Inter", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontSize:"2.5rem",fontWeight:700,letterSpacing:"-0.01562em",marginBottom:"1rem"},h2:{fontSize:"2rem",fontWeight:600,letterSpacing:"-0.00833em",marginBottom:"0.875rem"},h3:{fontSize:"1.75rem",fontWeight:600,letterSpacing:"0em",marginBottom:"0.75rem"},h4:{fontSize:"1.5rem",fontWeight:600,letterSpacing:"0.00735em",marginBottom:"0.625rem"},h5:{fontSize:"1.25rem",fontWeight:600,letterSpacing:"0em",marginBottom:"0.5rem"},h6:{fontSize:"1.125rem",fontWeight:600,letterSpacing:"0.0075em",marginBottom:"0.5rem"},body1:{fontSize:"1rem",lineHeight:1.6},body2:{fontSize:"0.875rem",lineHeight:1.6}},shape:{borderRadius:8}},ce={russet:"#8B4513",maple:"#D2691E",harvest:"#CD853F",sage:"#556B2F",wheat:"#F5DEB3",auburn:"#A0522D"},Ts={...Zn,palette:{mode:"light",primary:{main:ce.sage,light:"#6B8E23",dark:"#3B4A1F",contrastText:"#fff"},secondary:{main:ce.maple,light:"#FF7F50",dark:"#8B4513",contrastText:"#fff"},background:{default:"#FAF9F6",paper:"#FFFFFF"},text:{primary:ce.russet,secondary:ce.harvest}},components:{MuiPaper:{styleOverrides:{root:{boxShadow:"0 2px 12px 0 rgba(139, 69, 19, 0.05)",borderRadius:12}}},MuiButton:{styleOverrides:{root:{textTransform:"none",fontWeight:600,borderRadius:8,padding:"8px 20px"},contained:{boxShadow:"none","&:hover":{boxShadow:"0 2px 8px 0 rgba(139, 69, 19, 0.2)"}}}},MuiAppBar:{styleOverrides:{root:{backgroundColor:ce.sage}}}}},Ms={...Zn,palette:{mode:"dark",primary:{main:ce.maple,light:"#FF7F50",dark:"#8B4513",contrastText:"#fff"},secondary:{main:ce.harvest,light:"#DEB887",dark:"#8B5A2B",contrastText:"#fff"},background:{default:"#2C1810",paper:"#3D2317"},text:{primary:ce.wheat,secondary:ps(ce.wheat,.7)}},components:{MuiPaper:{styleOverrides:{root:{boxShadow:"0 2px 12px 0 rgba(0,0,0,0.2)",borderRadius:12,backgroundColor:"#3D2317"}}},MuiButton:{styleOverrides:{root:{textTransform:"none",fontWeight:600,borderRadius:8,padding:"8px 20px"},contained:{boxShadow:"none","&:hover":{boxShadow:"0 2px 8px 0 rgba(0,0,0,0.3)"}}}},MuiAppBar:{styleOverrides:{root:{backgroundColor:"#2C1810"}}}}},er=S.createContext();function tr(){return S.useContext(er)}function Bs({children:r}){const[e,t]=S.useState(()=>{const i=localStorage.getItem("darkMode");return i?JSON.parse(i):!1});S.useEffect(()=>{localStorage.setItem("darkMode",JSON.stringify(e))},[e]);const n=()=>{t(i=>!i)},s=S.useMemo(()=>gs(e?Ms:Ts),[e]),a={darkMode:e,toggleDarkMode:n};return c.jsx(er.Provider,{value:a,children:c.jsxs(ys,{theme:s,children:[c.jsx(_s,{}),r]})})}const Ft="RFC3986",$t={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},Ns="RFC1738",Ls=Array.isArray,ne=(()=>{const r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})(),St=1024,Ds=(r,e,t,n,s)=>{if(r.length===0)return r;let a=r;if(typeof r=="symbol"?a=Symbol.prototype.toString.call(r):typeof r!="string"&&(a=String(r)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=St){const l=a.length>=St?a.slice(o,o+St):a,u=[];for(let g=0;g<l.length;++g){let h=l.charCodeAt(g);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===Ns&&(h===40||h===41)){u[u.length]=l.charAt(g);continue}if(h<128){u[u.length]=ne[h];continue}if(h<2048){u[u.length]=ne[192|h>>6]+ne[128|h&63];continue}if(h<55296||h>=57344){u[u.length]=ne[224|h>>12]+ne[128|h>>6&63]+ne[128|h&63];continue}g+=1,h=65536+((h&1023)<<10|l.charCodeAt(g)&1023),u[u.length]=ne[240|h>>18]+ne[128|h>>12&63]+ne[128|h>>6&63]+ne[128|h&63]}i+=u.join("")}return i};function Us(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function bn(r,e){if(Ls(r)){const t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}const Ws=Object.prototype.hasOwnProperty,nr={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},re=Array.isArray,qs=Array.prototype.push,rr=function(r,e){qs.apply(r,re(e)?e:[e])},Js=Date.prototype.toISOString,B={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Ds,encodeValuesOnly:!1,format:Ft,formatter:$t[Ft],indices:!1,serializeDate(r){return Js.call(r)},skipNulls:!1,strictNullHandling:!1};function Hs(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}const Ct={};function sr(r,e,t,n,s,a,i,o,l,u,g,h,d,p,x,_,y,f){let m=r,C=f,w=0,O=!1;for(;(C=C.get(Ct))!==void 0&&!O;){const $=C.get(r);if(w+=1,typeof $<"u"){if($===w)throw new RangeError("Cyclic object value");O=!0}typeof C.get(Ct)>"u"&&(w=0)}if(typeof u=="function"?m=u(e,m):m instanceof Date?m=d==null?void 0:d(m):t==="comma"&&re(m)&&(m=bn(m,function($){return $ instanceof Date?d==null?void 0:d($):$})),m===null){if(a)return l&&!_?l(e,B.encoder,y,"key",p):e;m=""}if(Hs(m)||Us(m)){if(l){const $=_?e:l(e,B.encoder,y,"key",p);return[(x==null?void 0:x($))+"="+(x==null?void 0:x(l(m,B.encoder,y,"value",p)))]}return[(x==null?void 0:x(e))+"="+(x==null?void 0:x(String(m)))]}const E=[];if(typeof m>"u")return E;let v;if(t==="comma"&&re(m))_&&l&&(m=bn(m,l)),v=[{value:m.length>0?m.join(",")||null:void 0}];else if(re(u))v=u;else{const $=Object.keys(m);v=g?$.sort(g):$}const X=o?String(e).replace(/\./g,"%2E"):String(e),T=n&&re(m)&&m.length===1?X+"[]":X;if(s&&re(m)&&m.length===0)return T+"[]";for(let $=0;$<v.length;++$){const k=v[$],ge=typeof k=="object"&&typeof k.value<"u"?k.value:m[k];if(i&&ge===null)continue;const bt=h&&o?k.replace(/\./g,"%2E"):k,fs=re(m)?typeof t=="function"?t(T,bt):T:T+(h?"."+bt:"["+bt+"]");f.set(r,w);const yn=new WeakMap;yn.set(Ct,f),rr(E,sr(ge,fs,t,n,s,a,i,o,t==="comma"&&_&&re(m)?null:l,u,g,h,d,p,x,_,y,yn))}return E}function Vs(r=B){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=r.charset||B.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Ft;if(typeof r.format<"u"){if(!Ws.call($t,r.format))throw new TypeError("Unknown format option provided.");t=r.format}const n=$t[t];let s=B.filter;(typeof r.filter=="function"||re(r.filter))&&(s=r.filter);let a;if(r.arrayFormat&&r.arrayFormat in nr?a=r.arrayFormat:"indices"in r?a=r.indices?"indices":"repeat":a=B.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:B.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:B.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:B.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:B.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?B.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:B.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:B.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:B.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:B.encodeValuesOnly,filter:s,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:B.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:B.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:B.strictNullHandling}}function Xs(r,e={}){let t=r;const n=Vs(e);let s,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):re(n.filter)&&(a=n.filter,s=a);const i=[];if(typeof t!="object"||t===null)return"";const o=nr[n.arrayFormat],l=o==="comma"&&n.commaRoundTrip;s||(s=Object.keys(t)),n.sort&&s.sort(n.sort);const u=new WeakMap;for(let d=0;d<s.length;++d){const p=s[d];n.skipNulls&&t[p]===null||rr(i,sr(t[p],p,o,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,u))}const g=i.join(n.delimiter);let h=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),g.length>0?h+g:""}const be="4.73.1";let xn=!1,De,ar,ir,Tt,or,cr,lr,ur,hr;function zs(r,e={auto:!1}){if(xn)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(De)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${De}'\``);xn=e.auto,De=r.kind,ar=r.fetch,ir=r.FormData,Tt=r.File,or=r.ReadableStream,cr=r.getMultipartRequestOptions,lr=r.getDefaultAgent,ur=r.fileFromPath,hr=r.isFsReadStream}class Ks{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Gs({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,a;try{t=fetch,n=Request,s=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new Ks(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}De||zs(Gs(),{auto:!0});class A extends Error{}class D extends A{constructor(e,t,n,s){super(`${D.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"];const a=t;this.error=a,this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e)return new gt({message:n,cause:Bt(t)});const a=t==null?void 0:t.error;return e===400?new dr(e,a,n,s):e===401?new fr(e,a,n,s):e===403?new mr(e,a,n,s):e===404?new pr(e,a,n,s):e===409?new gr(e,a,n,s):e===422?new yr(e,a,n,s):e===429?new _r(e,a,n,s):e>=500?new wr(e,a,n,s):new D(e,a,n,s)}}class Y extends D{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class gt extends D{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class Vt extends gt{constructor({message:e}={}){super({message:e??"Request timed out."})}}class dr extends D{constructor(){super(...arguments),this.status=400}}class fr extends D{constructor(){super(...arguments),this.status=401}}class mr extends D{constructor(){super(...arguments),this.status=403}}class pr extends D{constructor(){super(...arguments),this.status=404}}class gr extends D{constructor(){super(...arguments),this.status=409}}class yr extends D{constructor(){super(...arguments),this.status=422}}class _r extends D{constructor(){super(...arguments),this.status=429}}class wr extends D{}class br extends A{constructor(){super("Could not parse response content as the length limit was reached")}}class xr extends A{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class me{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=me.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(me.NEWLINE_REGEXP);return n&&s.pop(),s.length===1&&!n?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new A(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new A(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new A("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}me.NEWLINE_CHARS=new Set([`
`,"\r"]);me.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class ae{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*s(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of Qs(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null){let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(o&&o.error)throw new D(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(i.data)}catch(l){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),l}if(i.event=="error")throw new D(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new ae(s,t)}static fromReadableStream(e,t){let n=!1;async function*s(){const i=new me,o=Sr(e);for await(const l of o)for(const u of i.decode(l))yield u;for(const l of i.flush())yield l}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of s())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new ae(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new ae(()=>s(e),this.controller),new ae(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new or({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:i}=await t.next();if(i)return s.close();const o=n.encode(JSON.stringify(a)+`
`);s.enqueue(o)}catch(a){s.error(a)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*Qs(r,e){if(!r.body)throw e.abort(),new A("Attempted to iterate over a response with no body");const t=new ea,n=new me,s=Sr(r.body);for await(const a of Ys(s))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*Ys(r){let e=new Uint8Array;for await(const t of r){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+n.length);s.set(e),s.set(n,e.length),e=s;let a;for(;(a=Zs(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}function Zs(r){for(let n=0;n<r.length-2;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}class ea{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=ta(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function ta(r,e){const t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}function Sr(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const Cr=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function",Ar=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&yt(r),yt=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",na=r=>Ar(r)||Cr(r)||hr(r);async function vr(r,e,t){var s;if(r=await r,Ar(r))return r;if(Cr(r)){const a=await r.blob();e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=yt(a)?[await a.arrayBuffer()]:[a];return new Tt(i,e,t)}const n=await ra(r);if(e||(e=aa(r)??"unknown_file"),!(t!=null&&t.type)){const a=(s=n[0])==null?void 0:s.type;typeof a=="string"&&(t={...t,type:a})}return new Tt(n,e,t)}async function ra(r){var t;let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(yt(r))e.push(await r.arrayBuffer());else if(ia(r))for await(const n of r)e.push(n);else throw new Error(`Unexpected data type: ${typeof r}; constructor: ${(t=r==null?void 0:r.constructor)==null?void 0:t.name}; props: ${sa(r)}`);return e}function sa(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}function aa(r){var e;return At(r.name)||At(r.filename)||((e=At(r.path))==null?void 0:e.split(/[\\/]/).pop())}const At=r=>{if(typeof r=="string")return r;if(typeof Buffer<"u"&&r instanceof Buffer)return String(r)},ia=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function",Sn=r=>r&&typeof r=="object"&&r.body&&r[Symbol.toStringTag]==="MultipartBody",Ie=async r=>{const e=await oa(r.body);return cr(e,r)},oa=async r=>{const e=new ir;return await Promise.all(Object.entries(r||{}).map(([t,n])=>Mt(e,t,n))),e},Mt=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(na(t)){const n=await vr(t);r.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>Mt(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,s])=>Mt(r,`${e}[${n}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Ae={},ca=function(r,e,t,n,s){if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t},la=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ge;async function Pr(r){const{response:e}=r;if(r.options.stream)return ve("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):ae.fromSSEResponse(e,r.controller);if(e.status===204)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const a=await e.json();return ve("response",e.status,e.url,e.headers,a),Er(a,e)}const s=await e.text();return ve("response",e.status,e.url,e.headers,s),s}function Er(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class _t extends Promise{constructor(e,t=Pr){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new _t(this.responsePromise,async t=>Er(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class ua{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:a}){this.baseURL=e,this.maxRetries=vt("maxRetries",t),this.timeout=vt("timeout",n),this.httpAgent=s,this.fetch=a??ar}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ga(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${ba()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async s=>{const a=s&&yt(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:a}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var _;const{method:n,path:s,query:a,headers:i={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:Sn(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,l=this.calculateContentLength(o),u=this.buildURL(s,a);"timeout"in e&&vt("timeout",e.timeout);const g=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??lr(u),d=g+1e3;typeof((_=h==null?void 0:h.options)==null?void 0:_.timeout)=="number"&&d>(h.options.timeout??0)&&(h.options.timeout=d),this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:i,contentLength:l,retryCount:t});return{req:{method:n,...o&&{body:o},headers:p,...h&&{agent:h},signal:e.signal??null},url:u,timeout:g}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:s}){const a={};n&&(a["content-length"]=n);const i=this.defaultHeaders(e);return Pn(a,i),Pn(a,t),Sn(e.body)&&De!=="node"&&delete a["content-type"],En(i,"x-stainless-retry-count")===void 0&&En(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(s)),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return D.generate(e,t,n,s)}request(e,t=null){return new _t(this.makeRequest(e,t))}async makeRequest(e,t){var h,d;const n=await e,s=n.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(n);const{req:a,url:i,timeout:o}=this.buildRequest(n,{retryCount:s-t});if(await this.prepareRequest(a,{url:i,options:n}),ve("request",i,n,a.headers),(h=n.signal)!=null&&h.aborted)throw new Y;const l=new AbortController,u=await this.fetchWithTimeout(i,a,o,l).catch(Bt);if(u instanceof Error){if((d=n.signal)!=null&&d.aborted)throw new Y;if(t)return this.retryRequest(n,t);throw u.name==="AbortError"?new Vt:new gt({cause:u})}const g=da(u.headers);if(!u.ok){if(t&&this.shouldRetry(u)){const m=`retrying, ${t} attempts remaining`;return ve(`response (error; ${m})`,u.status,i,g),this.retryRequest(n,t,g)}const p=await u.text().catch(m=>Bt(m).message),x=ya(p),_=x?void 0:p;throw ve(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,g,_),this.makeStatusError(u.status,x,_,g)}return{response:u,options:n,controller:l}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new ha(this,n,e)}buildURL(e,t){const n=wa(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return Rr(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new A(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,s){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),n);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...i}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let s;const a=n==null?void 0:n["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(s=o)}const i=n==null?void 0:n["retry-after"];if(i&&!s){const o=parseFloat(i);Number.isNaN(o)?s=Date.parse(i)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Je(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${be}`}}class Ir{constructor(e,t,n,s){Ge.set(this,void 0),ca(this,Ge,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new A("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,a]of n)e.url.searchParams.set(s,a);t.query=void 0,t.path=e.url.toString()}return await la(this,Ge,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ge=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class ha extends _t{constructor(e,t,n){super(t,async s=>new n(e,s.response,await Pr(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const da=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),fa={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},J=r=>typeof r=="object"&&r!==null&&!Rr(r)&&Object.keys(r).every(e=>kr(fa,e)),ma=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":be,"X-Stainless-OS":An(Deno.build.os),"X-Stainless-Arch":Cn(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":be,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":be,"X-Stainless-OS":An(process.platform),"X-Stainless-Arch":Cn(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=pa();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":be,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":be,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function pa(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${s}.${a}.${i}`}}}return null}const Cn=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",An=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown");let vn;const ga=()=>vn??(vn=ma()),ya=r=>{try{return JSON.parse(r)}catch{return}},_a=new RegExp("^(?:[a-z]+:)?//","i"),wa=r=>_a.test(r),Je=r=>new Promise(e=>setTimeout(e,r)),vt=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new A(`${r} must be an integer`);if(e<0)throw new A(`${r} must be a positive integer`);return e},Bt=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null)try{return new Error(JSON.stringify(r))}catch{}return new Error(r)},Qe=r=>{var e,t,n,s;if(typeof process<"u")return((e=Ae==null?void 0:Ae[r])==null?void 0:e.trim())??void 0;if(typeof Deno<"u")return(s=(n=(t=Deno.env)==null?void 0:t.get)==null?void 0:n.call(t,r))==null?void 0:s.trim()};function Rr(r){if(!r)return!0;for(const e in r)return!1;return!0}function kr(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Pn(r,e){for(const t in e){if(!kr(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];s===null?delete r[n]:s!==void 0&&(r[n]=s)}}function ve(r,...e){typeof process<"u"&&(Ae==null?void 0:Ae.DEBUG)==="true"&&console.log(`OpenAI:DEBUG:${r}`,...e)}const ba=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)}),xa=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Sa=r=>typeof(r==null?void 0:r.get)=="function",En=(r,e)=>{var n;const t=e.toLowerCase();if(Sa(r)){const s=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,t,e.toUpperCase(),s]){const i=r.get(a);if(i)return i}}for(const[s,a]of Object.entries(r))if(s.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a};function Pt(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}class Ca extends Ir{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class ee extends Ir{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class I{constructor(e){this._client=e}}let Or=class extends I{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},Xt=class extends I{constructor(){super(...arguments),this.completions=new Or(this._client)}};Xt.Completions=Or;class jr extends I{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}class Fr extends I{create(e,t){return this._client.post("/audio/transcriptions",Ie({body:e,...t}))}}class $r extends I{create(e,t){return this._client.post("/audio/translations",Ie({body:e,...t}))}}class He extends I{constructor(){super(...arguments),this.transcriptions=new Fr(this._client),this.translations=new $r(this._client),this.speech=new jr(this._client)}}He.Transcriptions=Fr;He.Translations=$r;He.Speech=jr;class zt extends I{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return J(e)?this.list({},e):this._client.getAPIList("/batches",Kt,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Kt extends ee{}zt.BatchesPage=Kt;class Gt extends I{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return J(e)?this.list({},e):this._client.getAPIList("/assistants",Qt,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Qt extends ee{}Gt.AssistantsPage=Qt;function In(r){return typeof r.parse=="function"}const Pe=r=>(r==null?void 0:r.role)==="assistant",Tr=r=>(r==null?void 0:r.role)==="function",Mr=r=>(r==null?void 0:r.role)==="tool";var G=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},F=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Nt,tt,nt,$e,Te,rt,Me,oe,Be,ct,lt,xe,Br;class Nr{constructor(){Nt.add(this),this.controller=new AbortController,tt.set(this,void 0),nt.set(this,()=>{}),$e.set(this,()=>{}),Te.set(this,void 0),rt.set(this,()=>{}),Me.set(this,()=>{}),oe.set(this,{}),Be.set(this,!1),ct.set(this,!1),lt.set(this,!1),xe.set(this,!1),G(this,tt,new Promise((e,t)=>{G(this,nt,e,"f"),G(this,$e,t,"f")}),"f"),G(this,Te,new Promise((e,t)=>{G(this,rt,e,"f"),G(this,Me,t,"f")}),"f"),F(this,tt,"f").catch(()=>{}),F(this,Te,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},F(this,Nt,"m",Br).bind(this))},0)}_connected(){this.ended||(F(this,nt,"f").call(this),this._emit("connect"))}get ended(){return F(this,Be,"f")}get errored(){return F(this,ct,"f")}get aborted(){return F(this,lt,"f")}abort(){this.controller.abort()}on(e,t){return(F(this,oe,"f")[e]||(F(this,oe,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=F(this,oe,"f")[e];if(!n)return this;const s=n.findIndex(a=>a.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(F(this,oe,"f")[e]||(F(this,oe,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{G(this,xe,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){G(this,xe,!0,"f"),await F(this,Te,"f")}_emit(e,...t){if(F(this,Be,"f"))return;e==="end"&&(G(this,Be,!0,"f"),F(this,rt,"f").call(this));const n=F(this,oe,"f")[e];if(n&&(F(this,oe,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!F(this,xe,"f")&&!(n!=null&&n.length)&&Promise.reject(s),F(this,$e,"f").call(this,s),F(this,Me,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!F(this,xe,"f")&&!(n!=null&&n.length)&&Promise.reject(s),F(this,$e,"f").call(this,s),F(this,Me,"f").call(this,s),this._emit("end")}}_emitFinal(){}}tt=new WeakMap,nt=new WeakMap,$e=new WeakMap,Te=new WeakMap,rt=new WeakMap,Me=new WeakMap,oe=new WeakMap,Be=new WeakMap,ct=new WeakMap,lt=new WeakMap,xe=new WeakMap,Nt=new WeakSet,Br=function(e){if(G(this,ct,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Y),e instanceof Y)return G(this,lt,!0,"f"),this._emit("abort",e);if(e instanceof A)return this._emit("error",e);if(e instanceof Error){const t=new A(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new A(String(e)))};function Lr(r){return(r==null?void 0:r.$brand)==="auto-parseable-response-format"}function Ve(r){return(r==null?void 0:r.$brand)==="auto-parseable-tool"}function Aa(r,e){return!e||!Dr(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:Yt(r,e)}function Yt(r,e){const t=r.choices.map(n=>{var s;if(n.finish_reason==="length")throw new br;if(n.finish_reason==="content_filter")throw new xr;return{...n,message:{...n.message,tool_calls:((s=n.message.tool_calls)==null?void 0:s.map(a=>Pa(e,a)))??[],parsed:n.message.content&&!n.message.refusal?va(e,n.message.content):null}}});return{...r,choices:t}}function va(r,e){var t,n;return((t=r.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=r.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function Pa(r,e){var n;const t=(n=r.tools)==null?void 0:n.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Ve(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Ea(r,e){var n;if(!r)return!1;const t=(n=r.tools)==null?void 0:n.find(s=>{var a;return((a=s.function)==null?void 0:a.name)===e.function.name});return Ve(t)||(t==null?void 0:t.function.strict)||!1}function Dr(r){var e;return Lr(r.response_format)?!0:((e=r.tools)==null?void 0:e.some(t=>Ve(t)||t.type==="function"&&t.function.strict===!0))??!1}function Ia(r){for(const e of r??[]){if(e.type!=="function")throw new A(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new A(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var q=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},U,Lt,ut,Dt,Ut,Wt,Ur,qt;const Rn=10;class Wr extends Nr{constructor(){super(...arguments),U.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Tr(e)||Mr(e))&&e.content)this._emit("functionCallResult",e.content);else if(Pe(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Pe(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new A("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),q(this,U,"m",Lt).call(this)}async finalMessage(){return await this.done(),q(this,U,"m",ut).call(this)}async finalFunctionCall(){return await this.done(),q(this,U,"m",Dt).call(this)}async finalFunctionCallResult(){return await this.done(),q(this,U,"m",Ut).call(this)}async totalUsage(){return await this.done(),q(this,U,"m",Wt).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=q(this,U,"m",ut).call(this);t&&this._emit("finalMessage",t);const n=q(this,U,"m",Lt).call(this);n&&this._emit("finalContent",n);const s=q(this,U,"m",Dt).call(this);s&&this._emit("finalFunctionCall",s);const a=q(this,U,"m",Ut).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",q(this,U,"m",Wt).call(this))}async _createChatCompletion(e,t,n){const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),q(this,U,"m",Ur).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Yt(a,t))}async _runChatCompletion(e,t,n){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var d;const s="function",{function_call:a="auto",stream:i,...o}=t,l=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:u=Rn}=n||{},g={};for(const p of t.functions)g[p.name||p.function.name]=p;const h=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<u;++p){const _=(d=(await this._createChatCompletion(e,{...o,function_call:a,functions:h,messages:[...this.messages]},n)).choices[0])==null?void 0:d.message;if(!_)throw new A("missing message in ChatCompletion response");if(!_.function_call)return;const{name:y,arguments:f}=_.function_call,m=g[y];if(m){if(l&&l!==y){const E=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,name:y,content:E});continue}}else{const E=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${h.map(v=>JSON.stringify(v.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:y,content:E});continue}let C;try{C=In(m)?await m.parse(f):f}catch(E){this._addMessage({role:s,name:y,content:E instanceof Error?E.message:String(E)});continue}const w=await m.function(C,this),O=q(this,U,"m",qt).call(this,w);if(this._addMessage({role:s,name:y,content:O}),l)return}}async _runTools(e,t,n){var p,x,_;const s="tool",{tool_choice:a="auto",stream:i,...o}=t,l=typeof a!="string"&&((p=a==null?void 0:a.function)==null?void 0:p.name),{maxChatCompletions:u=Rn}=n||{},g=t.tools.map(y=>{if(Ve(y)){if(!y.$callback)throw new A("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:y.$callback,name:y.function.name,description:y.function.description||"",parameters:y.function.parameters,parse:y.$parseRaw,strict:!0}}}return y}),h={};for(const y of g)y.type==="function"&&(h[y.function.name||y.function.function.name]=y.function);const d="tools"in t?g.map(y=>y.type==="function"?{type:"function",function:{name:y.function.name||y.function.function.name,parameters:y.function.parameters,description:y.function.description,strict:y.function.strict}}:y):void 0;for(const y of t.messages)this._addMessage(y,!1);for(let y=0;y<u;++y){const m=(x=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:d,messages:[...this.messages]},n)).choices[0])==null?void 0:x.message;if(!m)throw new A("missing message in ChatCompletion response");if(!((_=m.tool_calls)!=null&&_.length))return;for(const C of m.tool_calls){if(C.type!=="function")continue;const w=C.id,{name:O,arguments:E}=C.function,v=h[O];if(v){if(l&&l!==O){const k=`Invalid tool_call: ${JSON.stringify(O)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:w,content:k});continue}}else{const k=`Invalid tool_call: ${JSON.stringify(O)}. Available options are: ${Object.keys(h).map(ge=>JSON.stringify(ge)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:w,content:k});continue}let X;try{X=In(v)?await v.parse(E):E}catch(k){const ge=k instanceof Error?k.message:String(k);this._addMessage({role:s,tool_call_id:w,content:ge});continue}const T=await v.function(X,this),$=q(this,U,"m",qt).call(this,T);if(this._addMessage({role:s,tool_call_id:w,content:$}),l)return}}}}U=new WeakSet,Lt=function(){return q(this,U,"m",ut).call(this).content??null},ut=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Pe(t)){const{function_call:n,...s}=t,a={...s,content:t.content??null,refusal:t.refusal??null};return n&&(a.function_call=n),a}}throw new A("stream ended without producing a ChatCompletionMessage with role=assistant")},Dt=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const s=this.messages[n];if(Pe(s)&&(s!=null&&s.function_call))return s.function_call;if(Pe(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},Ut=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Tr(t)&&t.content!=null||Mr(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var s;return n.role==="assistant"&&((s=n.tool_calls)==null?void 0:s.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Wt=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Ur=function(e){if(e.n!=null&&e.n>1)throw new A("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},qt=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class We extends Wr{static runFunctions(e,t,n){const s=new We,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new We,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}_addMessage(e,t=!0){super._addMessage(e,t),Pe(e)&&e.content&&this._emit("content",e.content)}}const qr=1,Jr=2,Hr=4,Vr=8,Xr=16,zr=32,Kr=64,Gr=128,Qr=256,Yr=Gr|Qr,Zr=Xr|zr|Yr|Kr,es=qr|Jr|Zr,ts=Hr|Vr,Ra=es|ts,N={STR:qr,NUM:Jr,ARR:Hr,OBJ:Vr,NULL:Xr,BOOL:zr,NAN:Kr,INFINITY:Gr,MINUS_INFINITY:Qr,INF:Yr,SPECIAL:Zr,ATOM:es,COLLECTION:ts,ALL:Ra};class ka extends Error{}class Oa extends Error{}function ja(r,e=N.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return Fa(r.trim(),e)}const Fa=(r,e)=>{const t=r.length;let n=0;const s=d=>{throw new ka(`${d} at position ${n}`)},a=d=>{throw new Oa(`${d} at position ${n}`)},i=()=>(h(),n>=t&&s("Unexpected end of input"),r[n]==='"'?o():r[n]==="{"?l():r[n]==="["?u():r.substring(n,n+4)==="null"||N.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||N.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||N.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||N.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||N.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||N.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):g()),o=()=>{const d=n;let p=!1;for(n++;n<t&&(r[n]!=='"'||p&&r[n-1]==="\\");)p=r[n]==="\\"?!p:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(d,++n-Number(p)))}catch(x){a(String(x))}else if(N.STR&e)try{return JSON.parse(r.substring(d,n-Number(p))+'"')}catch{return JSON.parse(r.substring(d,r.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{n++,h();const d={};try{for(;r[n]!=="}";){if(h(),n>=t&&N.OBJ&e)return d;const p=o();h(),n++;try{const x=i();Object.defineProperty(d,p,{value:x,writable:!0,enumerable:!0,configurable:!0})}catch(x){if(N.OBJ&e)return d;throw x}h(),r[n]===","&&n++}}catch{if(N.OBJ&e)return d;s("Expected '}' at end of object")}return n++,d},u=()=>{n++;const d=[];try{for(;r[n]!=="]";)d.push(i()),h(),r[n]===","&&n++}catch{if(N.ARR&e)return d;s("Expected ']' at end of array")}return n++,d},g=()=>{if(n===0){r==="-"&&N.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r)}catch(p){if(N.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}a(String(p))}}const d=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(N.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(r.substring(d,n))}catch{r.substring(d,n)==="-"&&N.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(r.substring(d,r.lastIndexOf("e")))}catch(x){a(String(x))}}},h=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return i()},kn=r=>ja(r,N.ALL^N.NUM);var ye=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},R=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},M,ie,_e,ue,Et,Ye,It,Rt,kt,Ze,Ot,On;class qe extends Wr{constructor(e){super(),M.add(this),ie.set(this,void 0),_e.set(this,void 0),ue.set(this,void 0),ye(this,ie,e,"f"),ye(this,_e,[],"f")}get currentChatCompletionSnapshot(){return R(this,ue,"f")}static fromReadableStream(e){const t=new qe(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new qe(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),R(this,M,"m",Et).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)R(this,M,"m",It).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new Y;return this._addChatCompletion(R(this,M,"m",Ze).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),R(this,M,"m",Et).call(this),this._connected();const s=ae.fromReadableStream(e,this.controller);let a;for await(const o of s)a&&a!==o.id&&this._addChatCompletion(R(this,M,"m",Ze).call(this)),R(this,M,"m",It).call(this,o),a=o.id;if((i=s.controller.signal)!=null&&i.aborted)throw new Y;return this._addChatCompletion(R(this,M,"m",Ze).call(this))}[(ie=new WeakMap,_e=new WeakMap,ue=new WeakMap,M=new WeakSet,Et=function(){this.ended||ye(this,ue,void 0,"f")},Ye=function(t){let n=R(this,_e,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},R(this,_e,"f")[t.index]=n,n)},It=function(t){var s,a,i,o,l,u,g,h,d,p,x,_,y,f,m;if(this.ended)return;const n=R(this,M,"m",On).call(this,t);this._emit("chunk",t,n);for(const C of t.choices){const w=n.choices[C.index];C.delta.content!=null&&((s=w.message)==null?void 0:s.role)==="assistant"&&((a=w.message)!=null&&a.content)&&(this._emit("content",C.delta.content,w.message.content),this._emit("content.delta",{delta:C.delta.content,snapshot:w.message.content,parsed:w.message.parsed})),C.delta.refusal!=null&&((i=w.message)==null?void 0:i.role)==="assistant"&&((o=w.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:C.delta.refusal,snapshot:w.message.refusal}),((l=C.logprobs)==null?void 0:l.content)!=null&&((u=w.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(g=C.logprobs)==null?void 0:g.content,snapshot:((h=w.logprobs)==null?void 0:h.content)??[]}),((d=C.logprobs)==null?void 0:d.refusal)!=null&&((p=w.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(x=C.logprobs)==null?void 0:x.refusal,snapshot:((_=w.logprobs)==null?void 0:_.refusal)??[]});const O=R(this,M,"m",Ye).call(this,w);w.finish_reason&&(R(this,M,"m",kt).call(this,w),O.current_tool_call_index!=null&&R(this,M,"m",Rt).call(this,w,O.current_tool_call_index));for(const E of C.delta.tool_calls??[])O.current_tool_call_index!==E.index&&(R(this,M,"m",kt).call(this,w),O.current_tool_call_index!=null&&R(this,M,"m",Rt).call(this,w,O.current_tool_call_index)),O.current_tool_call_index=E.index;for(const E of C.delta.tool_calls??[]){const v=(y=w.message.tool_calls)==null?void 0:y[E.index];v!=null&&v.type&&((v==null?void 0:v.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(f=v.function)==null?void 0:f.name,index:E.index,arguments:v.function.arguments,parsed_arguments:v.function.parsed_arguments,arguments_delta:((m=E.function)==null?void 0:m.arguments)??""}):(v==null||v.type,void 0))}}},Rt=function(t,n){var i,o,l;if(R(this,M,"m",Ye).call(this,t).done_tool_calls.has(n))return;const a=(i=t.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const u=(l=(o=R(this,ie,"f"))==null?void 0:o.tools)==null?void 0:l.find(g=>g.type==="function"&&g.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:Ve(u)?u.$parseRaw(a.function.arguments):u!=null&&u.function.strict?JSON.parse(a.function.arguments):null})}else a.type},kt=function(t){var s,a;const n=R(this,M,"m",Ye).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const i=R(this,M,"m",Ot).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Ze=function(){if(this.ended)throw new A("stream has ended, this shouldn't happen");const t=R(this,ue,"f");if(!t)throw new A("request ended without sending any chunks");return ye(this,ue,void 0,"f"),ye(this,_e,[],"f"),$a(t,R(this,ie,"f"))},Ot=function(){var n;const t=(n=R(this,ie,"f"))==null?void 0:n.response_format;return Lr(t)?t:null},On=function(t){var n,s,a,i;let o=R(this,ue,"f");const{choices:l,...u}=t;o?Object.assign(o,u):o=ye(this,ue,{...u,choices:[]},"f");for(const{delta:g,finish_reason:h,index:d,logprobs:p=null,...x}of t.choices){let _=o.choices[d];if(_||(_=o.choices[d]={finish_reason:h,index:d,message:{},logprobs:p,...x}),p)if(!_.logprobs)_.logprobs=Object.assign({},p);else{const{content:E,refusal:v,...X}=p;Object.assign(_.logprobs,X),E&&((n=_.logprobs).content??(n.content=[]),_.logprobs.content.push(...E)),v&&((s=_.logprobs).refusal??(s.refusal=[]),_.logprobs.refusal.push(...v))}if(h&&(_.finish_reason=h,R(this,ie,"f")&&Dr(R(this,ie,"f")))){if(h==="length")throw new br;if(h==="content_filter")throw new xr}if(Object.assign(_,x),!g)continue;const{content:y,refusal:f,function_call:m,role:C,tool_calls:w,...O}=g;if(Object.assign(_.message,O),f&&(_.message.refusal=(_.message.refusal||"")+f),C&&(_.message.role=C),m&&(_.message.function_call?(m.name&&(_.message.function_call.name=m.name),m.arguments&&((a=_.message.function_call).arguments??(a.arguments=""),_.message.function_call.arguments+=m.arguments)):_.message.function_call=m),y&&(_.message.content=(_.message.content||"")+y,!_.message.refusal&&R(this,M,"m",Ot).call(this)&&(_.message.parsed=kn(_.message.content))),w){_.message.tool_calls||(_.message.tool_calls=[]);for(const{index:E,id:v,type:X,function:T,...$}of w){const k=(i=_.message.tool_calls)[E]??(i[E]={});Object.assign(k,$),v&&(k.id=v),X&&(k.type=X),T&&(k.function??(k.function={name:T.name??"",arguments:""})),T!=null&&T.name&&(k.function.name=T.name),T!=null&&T.arguments&&(k.function.arguments+=T.arguments,Ea(R(this,ie,"f"),k)&&(k.function.parsed_arguments=kn(k.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ae(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function $a(r,e){const{id:t,choices:n,created:s,model:a,system_fingerprint:i,...o}=r,l={...o,id:t,choices:n.map(({message:u,finish_reason:g,index:h,logprobs:d,...p})=>{if(!g)throw new A(`missing finish_reason for choice ${h}`);const{content:x=null,function_call:_,tool_calls:y,...f}=u,m=u.role;if(!m)throw new A(`missing role for choice ${h}`);if(_){const{arguments:C,name:w}=_;if(C==null)throw new A(`missing function_call.arguments for choice ${h}`);if(!w)throw new A(`missing function_call.name for choice ${h}`);return{...p,message:{content:x,function_call:{arguments:C,name:w},role:m,refusal:u.refusal??null},finish_reason:g,index:h,logprobs:d}}return y?{...p,index:h,finish_reason:g,logprobs:d,message:{...f,role:m,content:x,refusal:u.refusal??null,tool_calls:y.map((C,w)=>{const{function:O,type:E,id:v,...X}=C,{arguments:T,name:$,...k}=O||{};if(v==null)throw new A(`missing choices[${h}].tool_calls[${w}].id
${et(r)}`);if(E==null)throw new A(`missing choices[${h}].tool_calls[${w}].type
${et(r)}`);if($==null)throw new A(`missing choices[${h}].tool_calls[${w}].function.name
${et(r)}`);if(T==null)throw new A(`missing choices[${h}].tool_calls[${w}].function.arguments
${et(r)}`);return{...X,id:v,type:E,function:{...k,name:$,arguments:T}}})}}:{...p,message:{...f,content:x,role:m,refusal:u.refusal??null},finish_reason:g,index:h,logprobs:d}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return Aa(l,e)}function et(r){return JSON.stringify(r)}class Ee extends qe{static fromReadableStream(e){const t=new Ee(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new Ee(null),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,a)),s}static runTools(e,t,n){const s=new Ee(t),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,a)),s}}let ns=class extends I{parse(e,t){return Ia(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>Yt(n,e))}runFunctions(e,t){return e.stream?Ee.runFunctions(this._client,e,t):We.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Ee.runTools(this._client,e,t):We.runTools(this._client,e,t)}stream(e,t){return qe.createChatCompletion(this._client,e,t)}};class Jt extends I{constructor(){super(...arguments),this.completions=new ns(this._client)}}(function(r){r.Completions=ns})(Jt||(Jt={}));var b=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},H=function(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t},L,Ht,se,st,Q,fe,Se,de,ht,V,at,it,Ue,Ne,Le,jn,Fn,$n,Tn,Mn,Bn,Nn;class Z extends Nr{constructor(){super(...arguments),L.add(this),Ht.set(this,[]),se.set(this,{}),st.set(this,{}),Q.set(this,void 0),fe.set(this,void 0),Se.set(this,void 0),de.set(this,void 0),ht.set(this,void 0),V.set(this,void 0),at.set(this,void 0),it.set(this,void 0),Ue.set(this,void 0)}[(Ht=new WeakMap,se=new WeakMap,st=new WeakMap,Q=new WeakMap,fe=new WeakMap,Se=new WeakMap,de=new WeakMap,ht=new WeakMap,V=new WeakMap,at=new WeakMap,it=new WeakMap,Ue=new WeakMap,L=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",s=>{const a=t.shift();a?a.resolve(s):e.push(s)}),this.on("end",()=>{n=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),this.on("error",s=>{n=!0;for(const a of t)a.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Z;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=ae.fromReadableStream(e,this.controller);for await(const i of s)b(this,L,"m",Ne).call(this,i);if((a=s.controller.signal)!=null&&a.aborted)throw new Y;return this._addRun(b(this,L,"m",Le).call(this))}toReadableStream(){return new ae(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,a){const i=new Z;return i._run(()=>i._runToolAssistantStream(e,t,n,s,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,s,a){var u;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.submitToolOutputs(t,n,o,{...a,signal:this.controller.signal});this._connected();for await(const g of l)b(this,L,"m",Ne).call(this,g);if((u=l.controller.signal)!=null&&u.aborted)throw new Y;return this._addRun(b(this,L,"m",Le).call(this))}static createThreadAssistantStream(e,t,n){const s=new Z;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const a=new Z;return a._run(()=>a._runAssistantStream(e,t,n,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return b(this,at,"f")}currentRun(){return b(this,it,"f")}currentMessageSnapshot(){return b(this,Q,"f")}currentRunStepSnapshot(){return b(this,Ue,"f")}async finalRunSteps(){return await this.done(),Object.values(b(this,se,"f"))}async finalMessages(){return await this.done(),Object.values(b(this,st,"f"))}async finalRun(){if(await this.done(),!b(this,fe,"f"))throw Error("Final run was not received.");return b(this,fe,"f")}async _createThreadAssistantStream(e,t,n){var o;const s=n==null?void 0:n.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const l of i)b(this,L,"m",Ne).call(this,l);if((o=i.controller.signal)!=null&&o.aborted)throw new Y;return this._addRun(b(this,L,"m",Le).call(this))}async _createAssistantStream(e,t,n,s){var l;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...s,signal:this.controller.signal});this._connected();for await(const u of o)b(this,L,"m",Ne).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new Y;return this._addRun(b(this,L,"m",Le).call(this))}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let a=e[n];if(a==null){e[n]=s;continue}if(n==="index"||n==="type"){e[n]=s;continue}if(typeof a=="string"&&typeof s=="string")a+=s;else if(typeof a=="number"&&typeof s=="number")a+=s;else if(Pt(a)&&Pt(s))a=this.accumulateDelta(a,s);else if(Array.isArray(a)&&Array.isArray(s)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...s);continue}for(const i of s){if(!Pt(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=a[o];l==null?a.push(i):a[o]=this.accumulateDelta(l,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,s){return await this._createAssistantStream(t,e,n,s)}async _runToolAssistantStream(e,t,n,s,a){return await this._createToolAssistantStream(n,e,t,s,a)}}Ne=function(e){if(!this.ended)switch(H(this,at,e,"f"),b(this,L,"m",$n).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":b(this,L,"m",Nn).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":b(this,L,"m",Fn).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":b(this,L,"m",jn).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Le=function(){if(this.ended)throw new A("stream has ended, this shouldn't happen");if(!b(this,fe,"f"))throw Error("Final run has not been received");return b(this,fe,"f")},jn=function(e){const[t,n]=b(this,L,"m",Mn).call(this,e,b(this,Q,"f"));H(this,Q,t,"f"),b(this,st,"f")[t.id]=t;for(const s of n){const a=t.content[s.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let a=s.text,i=t.content[s.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=b(this,Se,"f")){if(b(this,de,"f"))switch(b(this,de,"f").type){case"text":this._emit("textDone",b(this,de,"f").text,b(this,Q,"f"));break;case"image_file":this._emit("imageFileDone",b(this,de,"f").image_file,b(this,Q,"f"));break}H(this,Se,s.index,"f")}H(this,de,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(b(this,Se,"f")!==void 0){const s=e.data.content[b(this,Se,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,b(this,Q,"f"));break;case"text":this._emit("textDone",s.text,b(this,Q,"f"));break}}b(this,Q,"f")&&this._emit("messageDone",e.data),H(this,Q,void 0,"f")}},Fn=function(e){const t=b(this,L,"m",Tn).call(this,e);switch(H(this,Ue,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==b(this,ht,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(b(this,V,"f")&&this._emit("toolCallDone",b(this,V,"f")),H(this,ht,a.index,"f"),H(this,V,t.step_details.tool_calls[a.index],"f"),b(this,V,"f")&&this._emit("toolCallCreated",b(this,V,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":H(this,Ue,void 0,"f"),e.data.step_details.type=="tool_calls"&&b(this,V,"f")&&(this._emit("toolCallDone",b(this,V,"f")),H(this,V,void 0,"f")),this._emit("runStepDone",e.data,t);break}},$n=function(e){b(this,Ht,"f").push(e),this._emit("event",e)},Tn=function(e){switch(e.event){case"thread.run.step.created":return b(this,se,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=b(this,se,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=Z.accumulateDelta(t,n.delta);b(this,se,"f")[e.data.id]=s}return b(this,se,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":b(this,se,"f")[e.data.id]=e.data;break}if(b(this,se,"f")[e.data.id])return b(this,se,"f")[e.data.id];throw new Error("No snapshot available")},Mn=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const a of s.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=b(this,L,"m",Bn).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Bn=function(e,t){return Z.accumulateDelta(t,e)},Nn=function(e){switch(H(this,it,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":H(this,fe,e.data,"f"),b(this,V,"f")&&(this._emit("toolCallDone",b(this,V,"f")),H(this,V,void 0,"f"));break}};class Zt extends I{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return J(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,en,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class en extends ee{}Zt.MessagesPage=en;class tn extends I{retrieve(e,t,n,s={},a){return J(s)?this.retrieve(e,t,n,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:s,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t,n={},s){return J(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,nn,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class nn extends ee{}tn.RunStepsPage=nn;class Xe extends I{constructor(){super(...arguments),this.steps=new tn(this._client)}create(e,t,n){const{include:s,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:a,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},n){return J(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,rn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}createAndStream(e,t,n){return Z.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Je(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return Z.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,s){const a=await this.submitToolOutputs(e,t,n,s);return await this.poll(e,a.id,s)}submitToolOutputsStream(e,t,n,s){return Z.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}}class rn extends ee{}Xe.RunsPage=rn;Xe.Steps=tn;Xe.RunStepsPage=nn;class Oe extends I{constructor(){super(...arguments),this.runs=new Xe(this._client),this.messages=new Zt(this._client)}create(e={},t){return J(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return Z.createThreadAssistantStream(e,this._client.beta.threads,t)}}Oe.Runs=Xe;Oe.RunsPage=rn;Oe.Messages=Zt;Oe.MessagesPage=en;const Ta=async r=>{const e=await Promise.allSettled(r),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const s of e)s.status==="fulfilled"&&n.push(s.value);return n};let sn=class extends I{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e,t={},n){return J(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,wt,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t,n);return await this.poll(e,s.id,n)}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:s}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=a.response.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Je(o);break;case"failed":case"completed":return i}}}async upload(e,t,n){const s=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:s.id},n)}async uploadAndPoll(e,t,n){const s=await this.upload(e,t,n);return await this.poll(e,s.id,n)}};class wt extends ee{}sn.VectorStoreFilesPage=wt;class rs extends I{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const s=await this.create(e,t);return await this.poll(e,s.id,n)}listFiles(e,t,n={},s){return J(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,wt,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,n){const s={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:s}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const l=i.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Je(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(s==null?void 0:s.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,l=t.values(),u=[...n];async function g(d){for(let p of d){const x=await o.files.create({file:p,purpose:"assistants"},s);u.push(x.id)}}const h=Array(i).fill(l).map(g);return await Ta(h),await this.createAndPoll(e,{file_ids:u})}}class je extends I{constructor(){super(...arguments),this.files=new sn(this._client),this.fileBatches=new rs(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return J(e)?this.list({},e):this._client.getAPIList("/vector_stores",an,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class an extends ee{}je.VectorStoresPage=an;je.Files=sn;je.VectorStoreFilesPage=wt;je.FileBatches=rs;class pe extends I{constructor(){super(...arguments),this.vectorStores=new je(this._client),this.chat=new Jt(this._client),this.assistants=new Gt(this._client),this.threads=new Oe(this._client)}}pe.VectorStores=je;pe.VectorStoresPage=an;pe.Assistants=Gt;pe.AssistantsPage=Qt;pe.Threads=Oe;class ss extends I{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class as extends I{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class on extends I{create(e,t){return this._client.post("/files",Ie({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return J(e)?this.list({},e):this._client.getAPIList("/files",cn,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t==null?void 0:t.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!s.has(i.status);)if(await Je(t),i=await this.retrieve(e),Date.now()-a>n)throw new Vt({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}}class cn extends ee{}on.FileObjectsPage=cn;class ln extends I{list(e,t={},n){return J(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,un,{query:t,...n})}}class un extends ee{}ln.FineTuningJobCheckpointsPage=un;class Fe extends I{constructor(){super(...arguments),this.checkpoints=new ln(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return J(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",hn,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return J(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,dn,{query:t,...n})}}class hn extends ee{}class dn extends ee{}Fe.FineTuningJobsPage=hn;Fe.FineTuningJobEventsPage=dn;Fe.Checkpoints=ln;Fe.FineTuningJobCheckpointsPage=un;class ze extends I{constructor(){super(...arguments),this.jobs=new Fe(this._client)}}ze.Jobs=Fe;ze.FineTuningJobsPage=hn;ze.FineTuningJobEventsPage=dn;class is extends I{createVariation(e,t){return this._client.post("/images/variations",Ie({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Ie({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class fn extends I{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",mn,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class mn extends Ca{}fn.ModelsPage=mn;class os extends I{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class cs extends I{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,Ie({body:t,...n}))}}class pn extends I{constructor(){super(...arguments),this.parts=new cs(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}pn.Parts=cs;var ls;class P extends ua{constructor({baseURL:e=Qe("OPENAI_BASE_URL"),apiKey:t=Qe("OPENAI_API_KEY"),organization:n=Qe("OPENAI_ORG_ID")??null,project:s=Qe("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new A("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:s,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&xa())throw new A(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new ss(this),this.chat=new Xt(this),this.embeddings=new as(this),this.files=new on(this),this.images=new is(this),this.audio=new He(this),this.moderations=new os(this),this.models=new fn(this),this.fineTuning=new ze(this),this.beta=new pe(this),this.batches=new zt(this),this.uploads=new pn(this),this._options=i,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Xs(e,{arrayFormat:"brackets"})}}ls=P;P.OpenAI=ls;P.DEFAULT_TIMEOUT=6e5;P.OpenAIError=A;P.APIError=D;P.APIConnectionError=gt;P.APIConnectionTimeoutError=Vt;P.APIUserAbortError=Y;P.NotFoundError=pr;P.ConflictError=gr;P.RateLimitError=_r;P.BadRequestError=dr;P.AuthenticationError=fr;P.InternalServerError=wr;P.PermissionDeniedError=mr;P.UnprocessableEntityError=yr;P.toFile=vr;P.fileFromPath=ur;P.Completions=ss;P.Chat=Xt;P.Embeddings=as;P.Files=on;P.FileObjectsPage=cn;P.Images=is;P.Audio=He;P.Moderations=os;P.Models=fn;P.ModelsPage=mn;P.FineTuning=ze;P.Beta=pe;P.Batches=zt;P.BatchesPage=Kt;P.Uploads=pn;class Ma{constructor(e){this.client=new P({apiKey:e,dangerouslyAllowBrowser:!0})}async generateCompletion(e,t={}){try{const n=await this.client.chat.completions.create({model:t.model||"gpt-4",messages:[{role:"user",content:e}],temperature:t.temperature||.7,max_tokens:t.maxTokens||1e3});return{text:n.choices[0].message.content,usage:n.usage}}catch(n){throw console.error("OpenAI API Error:",n),new Error(`OpenAI API Error: ${n.message}`)}}async generateImage(e,t={}){try{return(await this.client.images.generate({prompt:e,n:t.n||1,size:t.size||"1024x1024",quality:t.quality||"standard",style:t.style||"vivid"})).data}catch(n){throw console.error("OpenAI Image API Error:",n),new Error(`OpenAI Image API Error: ${n.message}`)}}}class Ba{constructor(e){this.apiKey=e}async generateCompletion(e,t={}){const s={...{model:"claude-3-opus-20240229",temperature:.7,maxTokens:1e3},...t};try{const a=await fetch("/api/anthropic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:this.apiKey,prompt:e,...s})});if(!a.ok){const o=await a.json();throw new Error(o.error||"API request failed")}const i=await a.json();if(i.error)throw new Error(i.error);return i.content}catch(a){throw a}}}class Na{constructor(e){this.apiKey=e}async generateCompletion(e,t={}){const s={...{model:"grok-1",temperature:.7,maxTokens:1e3},...t};try{const a=await fetch("/api/grok",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:this.apiKey,prompt:e,...s})});if(!a.ok){const o=await a.json();throw new Error(o.error||"API request failed")}const i=await a.json();if(i.error)throw new Error(i.error);return i.content}catch(a){throw a}}}class La{constructor(e){this.apiKey=e}async generateCompletion(e,t={}){const s={...{model:"pplx-7b-online",temperature:.7,maxTokens:1e3},...t};try{const a=await fetch("/api/perplexity",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:this.apiKey,prompt:e,...s})});if(!a.ok){const o=await a.json();throw new Error(o.error||"API request failed")}const i=await a.json();if(i.error)throw new Error(i.error);return i.content}catch(a){throw a}}}class Da{constructor(e){this.apiKey=e,this.baseUrl="https://google.serper.dev/search"}async generateCompletion(e,t={}){const n=new Headers;n.append("X-API-KEY",this.apiKey),n.append("Content-Type","application/json");const s={method:"POST",headers:n,body:JSON.stringify({q:e}),redirect:"follow"},i=await(await fetch(this.baseUrl,s)).json();let o=[];if(i.organic&&(o=i.organic.slice(0,5).map(l=>`${l.title}
${l.snippet}
[Source](${l.link})`)),i.knowledgeGraph){const l=i.knowledgeGraph;let u=[];l.title&&u.push(`${l.title}`),l.type&&u.push(`Type: ${l.type}`),l.description&&u.push(l.description),u.length>0&&o.push(u.join(`
`))}return i.relatedSearches&&o.push(...i.relatedSearches.map(l=>l.query)),{text:o.join(`

---

`)}}}const Ua={child_posts:["openai","anthropic","grok"],ideation:["openai","anthropic","grok"],research:["serper","perplexity"]},us=S.createContext();function Wa({children:r}){const{user:e}=ke(),[t,n]=S.useState(""),[s,a]=S.useState({}),[i,o]=S.useState(!1),[l,u]=S.useState(null),[g,h]=S.useState("ideation");S.useEffect(()=>{e!=null&&e.id&&d()},[e==null?void 0:e.id]),S.useEffect(()=>{l&&(async()=>{for(const f of["openai","anthropic","grok","perplexity","serper"]){const m=await p(f);m&&(a(C=>({...C,[f]:m})),t||n(f))}})()},[l]);const d=async()=>{if(!(e!=null&&e.id))return null;try{const{data:y,error:f}=await W.from("profiles").select("*").eq("id",e.id).single();return f?null:y}catch{return null}},p=async y=>{if(!(l!=null&&l[`api_${y}`]))return null;try{let f=null;switch(y){case"openai":f=new Ma(l.api_openai);break;case"anthropic":f=new Ba(l.api_anthropic);break;case"grok":f=new Na(l.api_grok);break;case"perplexity":f=new La(l.api_perplexity);break;case"serper":f=new Da(l.api_serper);break}return f&&(s[y]=f),f}catch(f){return console.error(`Error initializing ${y} service:`,f),null}},x=async()=>{if(t&&s[t])return s[t];for(const y of["openai","anthropic","grok","perplexity","serper"]){const f=await p(y);if(f)return n(y),f}return console.error("No AI service available"),null};S.useEffect(()=>{(async()=>{const f=await d();if(f){u(f);for(const m of["openai","anthropic","grok","perplexity","serper"])await p(m)}})()},[e]);const _={currentService:t,setCurrentService:n,services:s,loading:i,getCurrentService:x,reloadProfile:d,currentStep:g,setCurrentStep:h,availableServices:Ua[g]||[]};return c.jsx(us.Provider,{value:_,children:r})}function di(){const r=S.useContext(us);if(r===void 0)throw new Error("useAI must be used within an AIProvider");return r}const fi={openai:"OpenAI",anthropic:"Anthropic",grok:"Grok",perplexity:"Perplexity",serper:"Serper"};function z({children:r}){const{user:e}=ke();return e?r:c.jsx(ot,{to:"/login",replace:!0})}const qa=mt(c.jsx("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zM12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6"}),"Brightness4"),Ja=mt(c.jsx("path",{d:"M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zM12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6m0-10c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4"}),"Brightness7"),Ha=mt(c.jsx("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),Va=mt(c.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8zm2 16H8v-2h8zm0-4H8v-2h8zm-3-5V3.5L18.5 9z"}),"Description");function Xa(){const{user:r,signOut:e}=ke(),{darkMode:t,toggleDarkMode:n}=tr(),{interests:s,loading:a}=Fs(),{blogProfile:i,userProfile:o,loading:l,currentUsername:u,getFullLogoUrl:g}=pt(),[h,d]=S.useState(null),p=ft(),x=[...s||[]].sort((w,O)=>(w.sequence||0)-(O.sequence||0)),_=w=>{d(w.currentTarget)},y=()=>{d(null)},f=i||o,m=p.pathname==="/";if((a||l||!u)&&!m)return null;const C=g(m?i==null?void 0:i.logo:f==null?void 0:f.logo);return c.jsx(ws,{position:"sticky",sx:{borderRadius:0,"& .MuiButton-root":{borderRadius:0}},children:c.jsxs(bs,{children:[c.jsxs(xs,{direction:"row",spacing:1,alignItems:"center",sx:{flex:"0 0 auto"},children:[c.jsxs(we,{color:"inherit",component:he,to:m?"/":`/${i==null?void 0:i.username}`,sx:{textTransform:"none",fontSize:"1.2rem",fontWeight:500,display:"flex",alignItems:"center",gap:1},children:[c.jsx(Ce,{component:"img",src:C,alt:m?"Hiverarchy logo":`${i==null?void 0:i.username}'s logo`,sx:{height:32,width:32,objectFit:"contain",borderRadius:"4px"},onError:w=>{w.target.src="/images/default.jpg"}}),m?"Hiverarchy":(i==null?void 0:i.username)||"Hiverarchy"]}),!m&&(f==null?void 0:f.resume)&&c.jsx(we,{color:"inherit",component:he,to:`/${i==null?void 0:i.username}/resume`,startIcon:c.jsx(Va,{}),size:"small",sx:{textTransform:"none",whiteSpace:"nowrap",ml:1},children:"Resume"})]}),!m&&c.jsx(Ce,{sx:{flex:"1 1 auto",display:"flex",justifyContent:"center",alignItems:"center",gap:1,mx:2,overflow:"auto"},children:x.map(w=>c.jsx(we,{color:"inherit",component:he,to:`/${i==null?void 0:i.username}/interest/${w.name}`,sx:{whiteSpace:"nowrap"},children:w.title},w.id))}),c.jsxs(Ce,{sx:{flex:"0 0 auto",display:"flex",alignItems:"center",gap:1},children:[c.jsx(_n,{onClick:n,color:"inherit",children:t?c.jsx(Ja,{}):c.jsx(qa,{})}),r?c.jsxs(c.Fragment,{children:[c.jsx(_n,{color:"inherit",onClick:_,"aria-controls":"manage-menu","aria-haspopup":"true",children:c.jsx(Ha,{})}),c.jsxs(Ss,{id:"manage-menu",anchorEl:h,keepMounted:!0,open:!!h,onClose:y,children:[c.jsx(xt,{component:he,to:`/${i==null?void 0:i.username}/manage/posts`,onClick:y,children:"Manage Posts"}),c.jsx(xt,{component:he,to:`/${i==null?void 0:i.username}/manage/profile`,onClick:y,children:"Manage Profile"}),c.jsx(xt,{component:he,to:`/${i==null?void 0:i.username}/manage/interests`,onClick:y,children:"Manage Interests"})]}),c.jsx(we,{color:"inherit",onClick:e,children:"Sign Out"})]}):c.jsx(we,{color:"inherit",component:he,to:"/login",children:"Login"})]})]})})}function za(){Cs(),ke(),pt();const{darkMode:r}=tr();return c.jsx(As,{maxWidth:"lg",children:c.jsx(Ce,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",py:8},children:c.jsxs(le,{container:!0,spacing:4,children:[c.jsx(le,{item:!0,xs:12,children:c.jsxs(Ce,{sx:{textAlign:"center",mb:6},children:[c.jsx(te,{variant:"h2",component:"h1",gutterBottom:!0,children:"Welcome to Hiverarchy"}),c.jsx(te,{variant:"h5",color:"text.secondary",paragraph:!0,children:"A collaborative platform where developers share and evolve knowledge together"})]})}),c.jsx(le,{item:!0,xs:12,children:c.jsxs(le,{container:!0,spacing:4,children:[c.jsx(le,{item:!0,xs:12,md:4,children:c.jsxs(Ke,{elevation:3,sx:{p:3,height:"100%",backgroundColor:r?"rgba(255, 255, 255, 0.05)":"background.paper",borderRadius:0},children:[c.jsx(te,{variant:"h5",gutterBottom:!0,children:"Share Your Knowledge"}),c.jsx(te,{children:"Create your own space to share technical insights, tutorials, and experiences"})]})}),c.jsx(le,{item:!0,xs:12,md:4,children:c.jsxs(Ke,{elevation:3,sx:{p:3,height:"100%",backgroundColor:r?"rgba(255, 255, 255, 0.05)":"background.paper",borderRadius:0},children:[c.jsx(te,{variant:"h5",gutterBottom:!0,children:"Organize by Interests"}),c.jsx(te,{children:"Group your content by topics and interests for easy navigation"})]})}),c.jsx(le,{item:!0,xs:12,md:4,children:c.jsxs(Ke,{elevation:3,sx:{p:3,height:"100%",backgroundColor:r?"rgba(255, 255, 255, 0.05)":"background.paper",borderRadius:0},children:[c.jsx(te,{variant:"h5",gutterBottom:!0,children:"AI-Powered Writing"}),c.jsx(te,{children:"Use AI tools to help research, structure, and enhance your content"})]})})]})}),c.jsx(le,{item:!0,xs:12,children:c.jsxs(Ke,{elevation:3,sx:{p:4,mt:4,backgroundColor:r?"rgba(255, 255, 255, 0.05)":"background.paper",textAlign:"center",borderRadius:0},children:[c.jsx(te,{variant:"h5",gutterBottom:!0,children:"Featured Blog"}),c.jsx(te,{paragraph:!0,children:"Check out GolferGeek's blog to see the platform in action"}),c.jsx(we,{component:he,to:"/golfergeek",variant:"contained",size:"large",sx:{mt:2,borderRadius:0},children:"Visit GolferGeek's Blog"})]})})]})})})}const gn=()=>window.location.hostname,Re=()=>gn().includes("hiverarchy.com"),hs=()=>!Re()&&!dt(),dt=()=>gn()==="localhost",Ka=()=>Re(),Ga=()=>Re()&&window.location.pathname==="/",ds=async(r=null)=>{if(r!=null&&r.username)return r.username;if(dt())return"golfergeek";if(hs())return gn().split(".")[0];if(Re()){const e=window.location.pathname.split("/").filter(Boolean);if(e[0])return e[0]}return"golfergeek"},Qa=async(r,e=null)=>{const t=r.split("/").filter(Boolean),n=await ds(e);if(console.log("getRedirectPath:",{currentPath:r,parts:t,username:n,shouldShowUsername:Ka(),isLocalhost:dt(),isHiverarchy:Re()}),dt()||hs())return t.length===0?"/home":t[0]===n?"/"+t.slice(1).join("/"):null;if(Re()){if(t.length===0)return null;if(t[0]!==n)return`/${n}${t.length?"/"+t.join("/"):""}`}return null},jt=S.lazy(()=>K(()=>import("./Home-DC92nYi7.js"),__vite__mapDeps([0,1,2]))),Ya=S.lazy(()=>K(()=>import("./Login-D6IxvcFv.js"),__vite__mapDeps([3,1,2]))),Za=S.lazy(()=>K(()=>import("./SignUp-DATWsej5.js"),__vite__mapDeps([4,1,2]))),Ln=S.lazy(()=>K(()=>import("./ViewPost-BzYEoCnG.js"),__vite__mapDeps([5,1,6,7,8,9,10,11,12,2]))),Dn=S.lazy(()=>K(()=>import("./CreatePost-Bc6Q44Ml.js"),__vite__mapDeps([13,1,14,10,2]))),Un=S.lazy(()=>K(()=>import("./EditPost-hVR_G_zq.js"),__vite__mapDeps([15,1,16,14,10,2,8,9]))),Wn=S.lazy(()=>K(()=>import("./ManageInterests-BkZfIIUP.js"),__vite__mapDeps([17,1,14,10,2]))),qn=S.lazy(()=>K(()=>import("./InterestPage-e4LjAHhQ.js"),__vite__mapDeps([18,1,11,9,6,7,19,2]))),Jn=S.lazy(()=>K(()=>import("./UserProfile-BVIRr_4q.js"),__vite__mapDeps([20,1,14,10,2]))),Hn=S.lazy(()=>K(()=>import("./Posts-B3I6h7Nk.js"),__vite__mapDeps([21,1,10,19,11,2]))),Vn=S.lazy(()=>K(()=>import("./Resume-B4fUYP08.js"),__vite__mapDeps([22,1,6,7,2]))),Xn=S.lazy(()=>K(()=>import("./PostWriter-Q_u3KwUg.js"),__vite__mapDeps([23,1,10,12,16,6,7,2]))),ei=({children:r})=>{const{user:e}=ke(),{blogProfile:t,setBlogProfile:n,loading:s}=pt(),a=ft(),[i,o]=S.useState(!0),[l,u]=S.useState(null);return S.useEffect(()=>{(async()=>{try{if(!t){const d=await ds(null);if(console.log("Setting up blog profile for username:",d),d){const{data:p}=await W.from("profiles").select("*").eq("username",d).single();p?(console.log("Found profile:",p),n(p)):console.log("No profile found for username:",d)}}}catch(d){console.error("Error in setupBlogProfile:",d)}finally{o(!1)}})()},[t,n]),S.useEffect(()=>{(async()=>{if(!i&&!s){const d=await Qa(a.pathname,t);console.log("Checking redirection:",{currentPath:a.pathname,redirectPath:d,blogProfile:t==null?void 0:t.username}),u(d)}})()},[a.pathname,t,i,s]),i||s?(console.log("RouteGuard loading:",{isProcessing:i,profileLoading:s}),c.jsx(Ce,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:c.jsx(Es,{})})):l?(console.log("Redirecting to:",l),c.jsx(ot,{to:l,replace:!0})):(a.pathname.includes("/manage/")||a.pathname.includes("/create")||a.pathname.includes("/edit/")||a.pathname.includes("/writer/"))&&!e?(console.log("Protected route access denied"),c.jsx(ot,{to:"/",replace:!0})):r};function ti(){return c.jsx(vs,{children:c.jsx(Os,{children:c.jsx(Bs,{children:c.jsx(js,{children:c.jsx($s,{children:c.jsx(Wa,{children:c.jsxs(ei,{children:[c.jsx(Xa,{}),c.jsx("main",{className:"container",children:c.jsx(S.Suspense,{fallback:c.jsx("div",{children:"Loading..."}),children:c.jsxs(Ps,{children:[c.jsx(j,{path:"/",element:Ga()?c.jsx(za,{}):c.jsx(jt,{})}),c.jsx(j,{path:"/login",element:c.jsx(Ya,{})}),c.jsx(j,{path:"/signup",element:c.jsx(Za,{})}),c.jsx(j,{path:"/home",element:c.jsx(jt,{})}),c.jsx(j,{path:"/resume",element:c.jsx(Vn,{})}),c.jsx(j,{path:"/post/:id",element:c.jsx(Ln,{})}),c.jsx(j,{path:"/interest/:interest",element:c.jsx(qn,{})}),c.jsx(j,{path:"/create",element:c.jsx(z,{children:c.jsx(Dn,{})})}),c.jsx(j,{path:"/edit/:id",element:c.jsx(z,{children:c.jsx(Un,{})})}),c.jsx(j,{path:"/writer/:id",element:c.jsx(z,{children:c.jsx(Xn,{})})}),c.jsx(j,{path:"/manage/interests",element:c.jsx(z,{children:c.jsx(Wn,{})})}),c.jsx(j,{path:"/manage/profile",element:c.jsx(z,{children:c.jsx(Jn,{})})}),c.jsx(j,{path:"/manage/posts",element:c.jsx(z,{children:c.jsx(Hn,{})})}),c.jsxs(j,{path:"/:username",children:[c.jsx(j,{index:!0,element:c.jsx(jt,{})}),c.jsx(j,{path:"resume",element:c.jsx(Vn,{})}),c.jsx(j,{path:"post/:id",element:c.jsx(Ln,{})}),c.jsx(j,{path:"interest/:interest",element:c.jsx(qn,{})}),c.jsx(j,{path:"create",element:c.jsx(z,{children:c.jsx(Dn,{})})}),c.jsx(j,{path:"edit/:id",element:c.jsx(z,{children:c.jsx(Un,{})})}),c.jsx(j,{path:"writer/:id",element:c.jsx(z,{children:c.jsx(Xn,{})})}),c.jsx(j,{path:"manage/interests",element:c.jsx(z,{children:c.jsx(Wn,{})})}),c.jsx(j,{path:"manage/profile",element:c.jsx(z,{children:c.jsx(Jn,{})})}),c.jsx(j,{path:"manage/posts",element:c.jsx(z,{children:c.jsx(Hn,{})})})]}),c.jsx(j,{path:"*",element:c.jsx(ot,{to:"/",replace:!0})})]})})})]})})})})})})})}Kn(document.getElementById("root")).render(c.jsx(S.StrictMode,{children:c.jsx(ti,{})}));export{fi as A,pt as a,ke as b,di as c,W as s,Fs as u};
//# sourceMappingURL=index-BPoNtoii.js.map
