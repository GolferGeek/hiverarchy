import{i as G,j as e,u as Q,r as o,n as X,o as u,v as Y,y as E,P as Z,l as n,p as i,L as d,F as M,B as p,H as j,S as ee,J as _,K as I,O as D}from"./vendor-BEV2JtpX.js";import{E as te}from"./editor-CEOLRgZ6.js";import{b as re,a as se,s as l}from"./index-CWCCNURT.js";import{W as oe,C as ne,R as ae}from"./RefutationList-zB1CKDhq.js";import{C as ie}from"./ConfirmModal-B0ScqVMC.js";import{E as ce}from"./Edit-BOZ08VMc.js";import{D as de}from"./Delete-BxS1TgHm.js";import{f as S}from"./format-BzRktsyD.js";import"./supabase-BTz4VuFi.js";const B=G(e.jsx("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");function ge(){const{id:h}=Q(),[t,y]=o.useState(null),[$,g]=o.useState(!0),[C,b]=o.useState(null),[x,A]=o.useState(null),[v,R]=o.useState([]),[k,W]=o.useState(0),[q,F]=o.useState(0),L=X(),{user:P}=re(),[T,f]=o.useState(!1),z=P&&t&&P.id===t.user_id;t&&t.arc_id&&(t.arc_id,t.id);const{currentUsername:c}=se();o.useEffect(()=>{H()},[h]),o.useEffect(()=>{t!=null&&t.id&&U(t.id).then(r=>{y(s=>({...s,images:r}))})},[t==null?void 0:t.id]),o.useEffect(()=>{t&&(t.parent_id&&J(t.parent_id),K(t.id))},[t]);const H=async()=>{try{const{data:r,error:s}=await l.from("posts").select(`
          *,
          images (
            url
          )
        `).eq("id",h).single();if(s)throw s;y({...r,username:c}),g(!1)}catch(r){console.error("Error fetching post:",r),b("Failed to load post"),g(!1)}},U=async r=>{try{const{data:s,error:a}=await l.from("images").select("url").eq("post_id",r);if(a)throw a;return s}catch(s){return console.error("Error fetching images:",s),[]}};async function J(r){try{const{data:s,error:a}=await l.from("posts").select("*").eq("id",r).single();if(a)throw a;A({...s,username:c})}catch(s){console.error("Error fetching parent post:",s)}}async function K(r){try{const{data:s,error:a}=await l.from("posts").select("id, title, created_at").eq("parent_id",r).order("created_at",{ascending:!0});if(a)throw a;const w=s.map(m=>({...m,username:c})),V=w?Array.from(new Map(w.map(m=>[m.id,m])).values()):[];R(V)}catch(s){console.error("Error fetching child posts:",s)}}async function N(){var r;try{const{error:s}=await l.from("posts").delete().eq("id",h);if(s)throw s;const a=((r=t==null?void 0:t.interests)==null?void 0:r[0])||"coder";L(`/${a}`)}catch(s){console.error("Error deleting post:",s),b("Failed to delete post. Please try again."),f(!1)}}const O=()=>{f(!0)};return $?e.jsx(u,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(Y,{})}):C?e.jsx(u,{maxWidth:"lg",sx:{mt:4},children:e.jsx(E,{severity:"error",children:C})}):t?e.jsxs(u,{maxWidth:"lg",sx:{mt:4,mb:8},children:[e.jsxs(Z,{elevation:3,sx:{p:4},children:[e.jsxs(n,{sx:{mb:4},children:[t.parent_id&&x&&e.jsx(n,{sx:{mb:2},children:e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Part of thread: ",e.jsx(d,{to:`/${x.username}/post/${x.id}`,style:{color:"inherit",textDecoration:"underline"},children:x.title})]})}),e.jsx(i,{variant:"h4",gutterBottom:!0,children:t.title}),e.jsx(i,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:S(new Date(t.created_at),"MMMM d, yyyy")}),e.jsxs(n,{sx:{display:"flex",gap:4,mt:2,mb:2},children:[e.jsxs(n,{sx:{flex:1,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[e.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Interests"}),t.interest_names&&t.interest_names.map((r,s)=>e.jsx(M,{label:r,component:d,to:`/interest/${r}`,clickable:!0,sx:{mr:1,mb:1}},s))]}),e.jsxs(n,{sx:{flex:1,p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[e.jsx(i,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Tags"}),t.tag_names&&t.tag_names.map((r,s)=>e.jsx(M,{label:r,variant:"outlined",size:"small",sx:{mr:1,mb:1}},s))]})]}),e.jsx(n,{sx:{mt:3,display:"flex",gap:2},children:z&&e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"contained",color:"primary",component:d,to:`/${c}/create`,state:{parentPost:t},children:"Create Child Post"}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(ce,{}),component:d,to:`/${c}/edit/${t.id}`,children:"Edit"}),e.jsx(p,{variant:"outlined",color:"error",startIcon:e.jsx(de,{}),onClick:O,children:"Delete"}),e.jsx(oe,{postId:t.id})]})})]}),e.jsx(j,{sx:{my:3}}),e.jsx(n,{sx:{"& img":{maxWidth:"400px",maxHeight:"300px",height:"auto",objectFit:"contain"}},children:e.jsx(te.Markdown,{source:t.content})}),v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(j,{sx:{my:4}}),e.jsxs(n,{sx:{mt:2},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Continued in:"}),e.jsx(ee,{spacing:2,children:v.map(r=>e.jsxs(n,{component:d,to:`/${r.username}/post/${r.id}`,sx:{textDecoration:"none",color:"inherit",display:"flex",justifyContent:"space-between",alignItems:"center",p:2,border:"1px solid",borderColor:"divider",borderRadius:1,"&:hover":{backgroundColor:"action.hover"}},children:[e.jsx(i,{variant:"subtitle1",children:r.title}),e.jsx(i,{variant:"body2",color:"text.secondary",children:S(new Date(r.created_at),"MMMM d, yyyy")})]},r.id))})]})]}),e.jsx(j,{sx:{my:4}}),e.jsx(n,{sx:{mt:4},children:e.jsxs(_,{children:[e.jsx(I,{expandIcon:e.jsx(B,{}),"aria-controls":"comments-content",id:"comments-header",children:e.jsxs(i,{variant:"h5",children:["Comments (",k,")"]})}),e.jsx(D,{children:e.jsx(ne,{postId:t.id,onCountChange:W})})]})}),e.jsx(n,{sx:{mt:4},children:e.jsxs(_,{children:[e.jsx(I,{expandIcon:e.jsx(B,{}),"aria-controls":"refutations-content",id:"refutations-header",children:e.jsxs(i,{variant:"h5",children:["Refutations (",q,")"]})}),e.jsx(D,{children:e.jsx(ae,{postId:t.id,onCountChange:F})})]})})]}),e.jsx(ie,{open:T,onClose:()=>f(!1),onConfirm:N,title:"Delete Post",content:"Are you sure you want to delete this post? This action cannot be undone."})]}):e.jsx(u,{maxWidth:"lg",sx:{mt:4},children:e.jsx(E,{severity:"info",children:"Post not found"})})}export{ge as default};
//# sourceMappingURL=ViewPost-85a7olax.js.map
