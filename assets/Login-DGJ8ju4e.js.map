{"version":3,"file":"Login-DGJ8ju4e.js","sources":["../../src/pages/Login.jsx"],"sourcesContent":["import { useState } from 'react'\nimport { useNavigate, Link, useLocation } from 'react-router-dom'\nimport { useAuth } from '../contexts/AuthContext'\nimport { useProfile } from '../contexts/ProfileContext'\nimport {\n  Container,\n  Box,\n  TextField,\n  Button,\n  Typography,\n  Paper,\n  Link as MuiLink,\n  Alert,\n  CircularProgress,\n  Backdrop\n} from '@mui/material'\n\nfunction Login() {\n  const navigate = useNavigate()\n  const location = useLocation()\n  const { signIn } = useAuth()\n  const { fetchProfiles, userProfile } = useProfile()\n  const [email, setEmail] = useState('')\n  const [password, setPassword] = useState('')\n  const [error, setError] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [signingIn, setSigningIn] = useState(false)\n\n  async function handleSubmit(e) {\n    e.preventDefault()\n\n    try {\n      setError('')\n      setLoading(true)\n      setSigningIn(true)\n      \n      // First sign in\n      const { error: signInError } = await signIn({ email, password })\n      if (signInError) throw signInError\n\n      // Then fetch profiles and wait for the result\n      await fetchProfiles()\n\n      // Wait for profile to be loaded (max 2 seconds)\n      let attempts = 0\n      while (!userProfile && attempts < 20) {\n        await new Promise(resolve => setTimeout(resolve, 100))\n        attempts++\n      }\n\n      // Navigate to the user's homepage\n      if (userProfile?.username) {\n        navigate(`/${userProfile.username}`)\n      } else {\n        navigate('/manage/profile') // If no username set, go to profile setup\n      }\n\n    } catch (error) {\n      console.error('Login error:', error)\n      setError('Failed to sign in: ' + error.message)\n      setSigningIn(false)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <>\n      <Container maxWidth=\"sm\">\n        <Box sx={{ mt: 8 }}>\n          <Paper sx={{ p: 4 }}>\n            <Typography variant=\"h4\" component=\"h1\" gutterBottom align=\"center\">\n              Login\n            </Typography>\n            {error && (\n              <Alert severity=\"error\" sx={{ mb: 2 }}>\n                {error}\n              </Alert>\n            )}\n            <Box component=\"form\" onSubmit={handleSubmit}>\n              <TextField\n                fullWidth\n                label=\"Email\"\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                margin=\"normal\"\n                required\n                autoComplete=\"email\"\n              />\n              <TextField\n                fullWidth\n                label=\"Password\"\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                margin=\"normal\"\n                required\n                autoComplete=\"current-password\"\n              />\n              <Button\n                type=\"submit\"\n                fullWidth\n                variant=\"contained\"\n                sx={{ mt: 3, mb: 2 }}\n                disabled={loading}\n              >\n                {loading ? 'Signing in...' : 'Sign In'}\n              </Button>\n              <Box sx={{ textAlign: 'center' }}>\n                <MuiLink component={Link} to=\"/signup\" variant=\"body2\">\n                  Don't have an account? Sign Up\n                </MuiLink>\n              </Box>\n            </Box>\n          </Paper>\n        </Box>\n      </Container>\n      <Backdrop\n        sx={{ \n          color: '#fff', \n          zIndex: (theme) => theme.zIndex.drawer + 1,\n          display: 'flex',\n          flexDirection: 'column',\n          gap: 2\n        }}\n        open={signingIn}\n      >\n        <CircularProgress color=\"inherit\" />\n        <Typography variant=\"h6\">\n          Signing in...\n        </Typography>\n      </Backdrop>\n    </>\n  )\n}\n\nexport default Login "],"names":["Login","navigate","useNavigate","useLocation","signIn","useAuth","fetchProfiles","userProfile","useProfile","email","setEmail","useState","password","setPassword","error","setError","loading","setLoading","signingIn","setSigningIn","handleSubmit","e","signInError","attempts","resolve","jsxs","Fragment","jsx","Container","Box","Paper","Typography","Alert","TextField","Button","MuiLink","Link","Backdrop","theme","CircularProgress"],"mappings":"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"}