import{n as R,r as i,j as e,P as F,y as M,l as s,p as m,L as S,S as E,F as _,B as p,u as $,v as N,o as D,z as T,a7 as U}from"./vendor-BEV2JtpX.js";import{b as z,a as A,s as b}from"./index-BPoNtoii.js";import{C as B}from"./ConfirmModal-B0ScqVMC.js";import{f as L}from"./format-BzRktsyD.js";import{E as W}from"./editor-CEOLRgZ6.js";import{S as q}from"./Search-DzlEfj5V.js";import"./supabase-BTz4VuFi.js";function O({post:r,onDelete:l,showInterest:I=!0}){const{user:c}=z(),{currentUsername:k}=A(),w=R(),o="",[v,d]=i.useState(!1),[P,C]=i.useState(null),[f,j]=i.useState(null),x=(c==null?void 0:c.id)===o,y=t=>{if(!t)return null;const n=/!\[.*?\]\((.*?)\)/,a=t.match(n);return a?a[1]:null};i.useEffect(()=>{if(r.content){const t=y(r.content);t&&C(t)}},[r.content]);async function u(){try{j(null);const{error:t}=await b.from("images").delete().eq("post_id",r.id);t&&console.error("Error deleting images:",t);const{error:n}=await b.from("posts").delete().eq("id",r.id);if(n)throw n;l&&l(r.id),d(!1)}catch(t){console.error("Error deleting post:",t),j("Failed to delete post. Please try again.")}}const h=()=>{var n,a;switch((a=(n=r.interest_names)==null?void 0:n[0])==null?void 0:a.toLowerCase()){case"coder":return"/images/coder.jpg";case"golfer":return"/images/golfer.jpg";case"mentor":return"/images/mentor.jpg";case"aging":return"/images/aging.jpg";default:return"/images/default.jpg"}};return e.jsxs(e.Fragment,{children:[e.jsxs(F,{elevation:3,sx:{p:2,width:"100%"},children:[f&&e.jsx(M,{severity:"error",sx:{mb:2},children:f}),e.jsxs(s,{sx:{display:"flex",gap:3},children:[e.jsx(s,{component:"img",src:(()=>{var n,a;const t=(a=(n=r.images)==null?void 0:n[0])==null?void 0:a.url;try{return JSON.parse(t)[0]||h()}catch{return h()}})(),alt:r.title,sx:{width:150,height:150,objectFit:"cover",borderRadius:1,flexShrink:0},onError:t=>{t.target.src="/images/default.jpg"}}),e.jsxs(s,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[e.jsxs(s,{sx:{mb:1},children:[e.jsx(m,{variant:"h6",component:S,to:`/${k}/post/${r.id}`,sx:{textDecoration:"none",color:"inherit","&:hover":{color:"primary.main"}},children:r.title}),e.jsxs(s,{sx:{display:"flex",gap:2,alignItems:"center",mt:.5},children:[I&&r.interest_names&&e.jsx(E,{direction:"row",spacing:1,children:r.interest_names.map((t,n)=>e.jsx(_,{label:t,size:"small",color:"primary",variant:"outlined",component:S,to:`/${t}`,clickable:!0},n))}),e.jsx(m,{variant:"body2",color:"text.secondary",children:L(new Date(r.created_at),"MMMM d, yyyy")})]})]}),Array.isArray(r.tag_names)&&r.tag_names.length>0&&e.jsx(E,{direction:"row",spacing:1,sx:{mt:1,mb:2,flexWrap:"wrap",gap:1},children:r.tag_names.map((t,n)=>e.jsx(_,{label:t,size:"small",color:"secondary",variant:"outlined",sx:{borderRadius:"4px","&:hover":{backgroundColor:"secondary.light",color:"white"}}},n))}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mt:1},children:r.brief_description||"No brief description available"}),e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:"auto"},children:[e.jsx(p,{component:S,to:`/post/${r.id}`,variant:"contained",color:"primary",size:"small",children:"Read More"}),x&&e.jsxs(E,{direction:"row",spacing:1,children:[e.jsx(p,{onClick:()=>w(`/edit/${r.id}`),variant:"outlined",color:"primary",size:"small",children:"Edit"}),e.jsx(p,{onClick:()=>d(!0),variant:"outlined",color:"error",size:"small",children:"Delete"})]})]})]})]})]}),e.jsx(B,{open:v,onClose:()=>d(!1),onConfirm:u,title:"Delete Post",content:"Are you sure you want to delete this post? This action cannot be undone."})]})}function Y(){const r=R(),{interest:l,username:I}=$(),{user:c}=z(),{profile:k,currentUsername:w}=A(),[o,v]=i.useState(null),[d,P]=i.useState([]),[C,f]=i.useState(""),[j,x]=i.useState(!0),[y,u]=i.useState(null),h=(c==null?void 0:c.id)===(o==null?void 0:o.user_id);return i.useEffect(()=>{let t=!0;return(async()=>{if(!l){x(!1),u("No interest specified");return}x(!0);try{const[a,g]=await Promise.all([b.from("interests").select("*").eq("name",l).single(),b.from("posts").select("*").contains("interest_names",[l])]);if(a.error)throw a.error;if(g.error)throw g.error;t&&(v(a.data),P(g.data||[]),u(null))}catch(a){t&&(u("Failed to fetch interest data"),console.error("Error fetching interest data:",a))}finally{t&&x(!1)}})(),()=>{t=!1}},[l]),j?e.jsxs(s,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"background.default",zIndex:1e3},children:[e.jsx(N,{}),e.jsx(m,{sx:{mt:2},children:"Loading interest..."})]}):y?e.jsxs(D,{maxWidth:"lg",sx:{mt:4},children:[e.jsx(M,{severity:"error",sx:{mb:2},children:y}),e.jsx(p,{variant:"contained",onClick:()=>r("/"),children:"Return to Home"})]}):e.jsxs(D,{maxWidth:"lg",children:[e.jsxs(s,{sx:{mt:4,mb:6,textAlign:"center"},children:[e.jsx(m,{variant:"h3",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold",color:"primary.main",textTransform:"capitalize"},children:o.name}),o.image_path&&e.jsx(s,{component:"img",src:o.image_path,alt:o.name,sx:{width:"100%",height:"300px",objectFit:"cover",borderRadius:2,boxShadow:3,mb:4},onError:t=>{console.error(`Failed to load image for ${o.name}:`,o.image_path),t.target.style.display="none"}})]}),o.content&&e.jsx(s,{sx:{mt:2,"& .w-md-editor":{margin:0,boxShadow:"none",border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:1,height:"1000px"},"& .wmde-markdown":{padding:"16px"},"& .w-md-editor-toolbar":{padding:"8px",borderBottom:"1px solid rgba(0, 0, 0, 0.1)"},"& .w-md-editor-content":{height:"calc(100% - 40px) !important"},"& .w-md-editor-input":{height:"100% !important"},"& .w-md-editor-text":{height:"100% !important"},"& .w-md-editor-text-input":{padding:"16px !important",height:"100% !important"},"& .w-md-editor-preview":{padding:"16px !important",height:"100% !important"}},children:e.jsx(W.Markdown,{source:o.content,highlightEnable:!1})}),h&&e.jsx(s,{sx:{mb:4,display:"flex",justifyContent:"center"},children:e.jsx(p,{variant:"contained",size:"large",onClick:()=>r(`/${w}/create`,{state:{interest:o}}),sx:{px:4,py:1.5,borderRadius:2,textTransform:"none",fontSize:"1.1rem"},children:"Create New Post"})}),e.jsx(F,{elevation:1,sx:{p:3,mb:4,backgroundColor:"background.paper"},children:e.jsx(T,{fullWidth:!0,label:"Search Posts",variant:"outlined",value:C,onChange:t=>f(t.target.value),InputProps:{endAdornment:e.jsx(U,{position:"end",children:e.jsx(q,{})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,"&:hover fieldset":{borderColor:"primary.main"}}}})}),e.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:4},children:[d.map(t=>e.jsx(O,{post:t,showInterest:!1,onEdit:h?()=>r(`/edit/${t.id}`):void 0,onDelete:()=>fetchPosts(),level:0},t.id)),d.length===0&&e.jsx(m,{variant:"h6",align:"center",sx:{mt:4,color:"text.secondary",fontStyle:"italic"},children:"No posts found"})]})]})}export{Y as default};
//# sourceMappingURL=InterestPage-e4LjAHhQ.js.map
