import{r as a,j as t,o as $,l as i,p as l,z as o,B as F}from"./vendor-BEV2JtpX.js";import{M as N,I as z}from"./MarkdownEditor-CiQUfrIG.js";import{c as D,a as V,s as n}from"./index-BPoNtoii.js";import"./Delete-BxS1TgHm.js";import"./supabase-BTz4VuFi.js";const Z=()=>{const[u,f]=a.useState(""),[x,b]=a.useState(""),[p,d]=a.useState(null),[v,y]=a.useState(""),[s,w]=a.useState(!1),[g,m]=a.useState(""),[j,S]=a.useState(""),[A,P]=a.useState(""),[E,k]=a.useState(""),[U,_]=a.useState(""),[C,I]=a.useState(""),c=D(),{fetchProfiles:L}=V();a.useEffect(()=>{T()},[]);const W=e=>e?e.startsWith("http")?e:`https://ssqyknqsfdtdxqocaiwm.supabase.co/storage/v1/object/public/profile_logos/${e}`:null,T=async()=>{try{const{data:{user:e}}=await n.auth.getUser();if(!e)throw new Error("No user found");const{data:r,error:h}=await n.from("profiles").select("*").eq("id",e.id).single();if(h)throw h;r&&(f(r.username||""),b(r.resume||""),d(r.logo?W(r.logo):null),y(r.tagline||""),S(r.api_openai||""),P(r.api_anthropic||""),k(r.api_grok||""),_(r.api_perplexity||""),I(r.api_serper||""))}catch(e){console.error("Error fetching profile:",e.message),m("Error fetching profile")}},O=e=>{e&&e.length>0&&d(W(e[0]))},R=async()=>{d(null)},G=async()=>{try{w(!0);const{data:{user:e}}=await n.auth.getUser();if(!e)throw new Error("No user found");if(!u.trim())throw new Error("Username is required");const{data:r,error:h}=await n.from("profiles").select("id").eq("username",u.trim()).neq("id",e.id).single();if(r)throw new Error("Username is already taken");let q=null;if(p){const K=p.match(/\/([^/]+)$/);q=K?K[1]:null}const M={id:e.id,username:u.trim(),resume:x,logo:q,tagline:v,api_openai:j,api_anthropic:A,api_grok:E,api_perplexity:U,api_serper:C,updated_at:new Date().toISOString()},{error:B}=await n.from("profiles").upsert(M);if(B)throw B;c!=null&&c.loadServices&&await c.loadServices(),await L(),m("Profile updated successfully")}catch(e){console.error("Error updating profile:",e),m(`Error updating profile: ${e.message}`)}finally{w(!1)}};return t.jsxs($,{maxWidth:"md",children:[t.jsxs(i,{sx:{mt:4,mb:2},children:[t.jsx(l,{variant:"h4",component:"h1",gutterBottom:!0,children:"User Profile"}),g&&t.jsx(l,{color:g.includes("Error")?"error":"success",gutterBottom:!0,children:g})]}),t.jsxs(i,{component:"form",noValidate:!0,sx:{mt:1},children:[t.jsx(o,{margin:"normal",required:!0,fullWidth:!0,label:"Username",value:u,onChange:e=>f(e.target.value),disabled:s}),t.jsx(o,{margin:"normal",fullWidth:!0,label:"Tagline",value:v,onChange:e=>y(e.target.value),disabled:s,helperText:"A brief description that appears on the home page"}),t.jsxs(i,{sx:{mt:2,mb:2},children:[t.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:"Resume (Markdown)"}),t.jsx(N,{value:x,onChange:b})]}),t.jsxs(i,{sx:{mt:2,mb:2},children:[t.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:"Logo"}),t.jsx(z,{onUpload:O,onRemove:R,existingImages:p?[p]:[],bucket:"profile_logos",showCopyOption:!1})]}),t.jsxs(i,{sx:{mt:2,mb:2},children:[t.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:"API Keys"}),t.jsx(o,{margin:"normal",fullWidth:!0,label:"OpenAI API Key",value:j,onChange:e=>S(e.target.value),type:"password",disabled:s}),t.jsx(o,{margin:"normal",fullWidth:!0,label:"Anthropic API Key",value:A,onChange:e=>P(e.target.value),type:"password",disabled:s}),t.jsx(o,{margin:"normal",fullWidth:!0,label:"Grok2 API Key",value:E,onChange:e=>k(e.target.value),type:"password",disabled:s}),t.jsx(o,{margin:"normal",fullWidth:!0,label:"Perplexity API Key",value:U,onChange:e=>_(e.target.value),type:"password",disabled:s}),t.jsx(o,{margin:"normal",fullWidth:!0,label:"Serper API Key",value:C,onChange:e=>I(e.target.value),type:"password",disabled:s,helperText:"API key for Serper.dev Google search service"})]}),t.jsx(F,{fullWidth:!0,variant:"contained",onClick:G,disabled:s,sx:{mt:3,mb:2},children:s?"Saving...":"Save Profile"})]})]})};export{Z as default};
//# sourceMappingURL=UserProfile-BVIRr_4q.js.map
